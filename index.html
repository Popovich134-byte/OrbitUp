<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OrbitUp Final</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600;700&display=swap');
        
        :root { 
            --neon: #39FF14; 
            --ton: #0098EA; 
            --bg: #000000; 
            --card-bg: #1C1C1E; 
            --blue-btn: #007AFF; 
            --stars: #FFD700;
        }

        /* Safe Areas –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        body { 
            background: transparent; 
            color: white; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
            height: 100vh; 
            height: 100dvh; /* Dynamic viewport height */
            margin: 0; 
            user-select: none;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
            position: relative;
        }
        .font-tech { font-family: 'Orbitron', sans-serif; }
        
        /* Loading */
        #loading-screen { 
            position: fixed; 
            inset: 0; 
            z-index: 9999; 
            background: #000; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            transition: opacity 0.5s ease; 
        }
        .loading-bar-bg { width: 160px; height: 4px; background: #222; border-radius: 10px; margin-top: 20px; overflow: hidden; }
        .loading-bar-fill { height: 100%; background: var(--blue-btn); width: 0%; transition: width 0.5s ease; box-shadow: 0 0 15px var(--blue-btn); }

        /* Global neon borders (–∑–∞–º–µ–Ω–∞ border-gray-800) */
        .border-gray-800,
        .border-gray-700,
        .border-gray-600 {
            border-color: rgba(16, 185, 129, 0.22) !important;
            border-image: linear-gradient(135deg, rgba(16,185,129,0), rgba(16,185,129,0.65), rgba(16,185,129,0)) 1;
        }

        /* Glassmorphism 2.0 - –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ */
        .glass-panel { 
            background: rgba(28, 28, 30, 0.6); 
            backdrop-filter: blur(26px) saturate(190%);
            -webkit-backdrop-filter: blur(26px) saturate(190%);
            border: 1px solid transparent;
            background-image:
                linear-gradient(rgba(2, 6, 23, 0.55), rgba(2, 6, 23, 0.55)),
                linear-gradient(135deg, rgba(16,185,129,0), rgba(16,185,129,0.45), rgba(16,185,129,0));
            background-origin: padding-box, border-box;
            background-clip: padding-box, border-box;
            position: relative;
            overflow: hidden;
        }
        .glass-panel::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, rgba(16,185,129,0.16) 45%, transparent 100%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            pointer-events: none;
            animation: borderGlow 3s ease-in-out infinite;
        }
        /* –°–∫–∞–Ω–∏—Ä—É—é—â–∏–π –±–ª–∏–∫ –ø–æ –≤–∞–∂–Ω—ã–º –∫–∞—Ä—Ç–æ—á–∫–∞–º */
        .glass-panel::after {
            content: '';
            position: absolute;
            top: -35%;
            left: -140%;
            width: 70%;
            height: 170%;
            background: linear-gradient(115deg, transparent 0%, rgba(255,255,255,0.06) 35%, rgba(34,197,94,0.10) 45%, rgba(255,255,255,0.05) 55%, transparent 100%);
            transform: rotate(12deg);
            opacity: 0;
            pointer-events: none;
            animation: scanGlint 5s ease-in-out infinite;
        }
        @keyframes scanGlint {
            0%, 74% { opacity: 0; transform: translateX(0) rotate(12deg); }
            78% { opacity: 1; }
            88% { opacity: 1; transform: translateX(260%) rotate(12deg); }
            100% { opacity: 0; transform: translateX(260%) rotate(12deg); }
        }
        @keyframes borderGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .orbit-card { background: var(--card-bg); border-radius: 24px; }
        
        /* –ö–Ω–æ–ø–∫–∏ —Å –ø—É–ª—å—Å–∞—Ü–∏–µ–π */
        .primary-btn { 
            background: var(--blue-btn); 
            color: white; 
            font-weight: 600; 
            border-radius: 14px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; 
            align-items: center; 
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .primary-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .primary-btn:active { transform: scale(0.98); }
        .primary-btn:active::before { opacity: 1; }
        
        .secondary-btn { 
            background: #2C2C2E; 
            color: white; 
            font-weight: 600; 
            border-radius: 14px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; 
            align-items: center; 
            justify-content: center;
        }
        .secondary-btn:active { transform: scale(0.98); opacity: 0.8; }
        
        .neon-btn { 
            background: var(--neon); 
            color: black; 
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.4), 0 0 40px rgba(57, 255, 20, 0.2);
            animation: pulseNeon 2s ease-in-out infinite;
        }
        @keyframes pulseNeon {
            0%, 100% { box-shadow: 0 0 20px rgba(57, 255, 20, 0.4), 0 0 40px rgba(57, 255, 20, 0.2); }
            50% { box-shadow: 0 0 30px rgba(57, 255, 20, 0.6), 0 0 60px rgba(57, 255, 20, 0.4); }
        }
        
        .ton-btn { 
            background: var(--ton); 
            color: white; 
            box-shadow: 0 0 20px rgba(0, 152, 234, 0.4), 0 0 40px rgba(0, 152, 234, 0.2);
            animation: pulseTon 2s ease-in-out infinite;
        }
        @keyframes pulseTon {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 152, 234, 0.4), 0 0 40px rgba(0, 152, 234, 0.2); }
            50% { box-shadow: 0 0 30px rgba(0, 152, 234, 0.6), 0 0 60px rgba(0, 152, 234, 0.4); }
        }
        
        .action-btn { 
            font-weight: 800; 
            border-radius: 14px; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .action-btn:active { transform: scale(0.95); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –ø–∞—Ä—è—â–µ–π –∫–∞–ø–ª–∏ */
        .nav-dock { 
            position: fixed; 
            bottom: max(20px, env(safe-area-inset-bottom)); 
            left: 50%; 
            transform: translateX(-50%); 
            width: 92%; 
            max-width: 380px; 
            background: rgba(2, 6, 23, 0.62); 
            backdrop-filter: blur(34px) saturate(200%);
            -webkit-backdrop-filter: blur(34px) saturate(200%);
            border: 1px solid rgba(16, 185, 129, 0.18); 
            border-radius: 24px; 
            display: flex; 
            justify-content: space-around; 
            padding: 12px 0; 
            z-index: 50;
            box-shadow: 0 18px 55px rgba(0, 0, 0, 0.85), 0 0 38px rgba(34, 197, 94, 0.22);
        }
        .nav-item { 
            color: #555; 
            padding: 8px; 
            border-radius: 12px; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 4px; 
            position: relative;
            cursor: pointer;
        }
        .nav-item span { font-size: 9px; font-weight: 600; transition: all 0.3s; }
        .nav-item.active { 
            color: var(--neon); 
            transform: translateY(-3px) scale(1.08);
        }
        .nav-item.active svg { 
            filter: drop-shadow(0 0 14px rgba(57, 255, 20, 0.75)) drop-shadow(0 0 28px rgba(57, 255, 20, 0.28)); 
        }
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: -8px;
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
            border-radius: 0 0 3px 3px;
            animation: dropletFloat 2s ease-in-out infinite;
        }
        @keyframes dropletFloat {
            0%, 100% { transform: translateY(0) scaleY(1); opacity: 0.8; }
            50% { transform: translateY(-2px) scaleY(1.1); opacity: 1; }
        }

        /* –ü–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏ */
        .tab-content { 
            display: none; 
            height: calc(100vh - 90px);
            height: calc(100dvh - 90px);
            overflow-y: auto; 
            padding: 20px; 
            padding-bottom: max(120px, calc(120px + env(safe-area-inset-bottom))); 
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tab-content.active { 
            display: block; 
            opacity: 1;
            transform: translateY(0);
        }

        /* Crash/Cases */
        .crash-switch { background: #111; border-radius: 12px; padding: 3px; display: inline-flex; border: 1px solid #333; margin-bottom: 15px; }
        .switch-opt { padding: 8px 16px; border-radius: 9px; font-size: 11px; font-weight: bold; color: #666; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .switch-opt.active-s { background: rgba(57, 255, 20, 0.15); color: var(--neon); border: 1px solid var(--neon); box-shadow: 0 0 15px rgba(57, 255, 20, 0.3); }
        .switch-opt.active-t { background: rgba(0, 152, 234, 0.15); color: var(--ton); border: 1px solid var(--ton); box-shadow: 0 0 15px rgba(0, 152, 234, 0.3); }
        
        .roulette-wrapper { position: relative; width: 100%; height: 110px; background: #000; border-radius: 16px; overflow: hidden; border: 1px solid #333; margin-bottom: 20px; }
        .roulette-track { display: flex; position: absolute; height: 100%; align-items: center; left: 0; will-change: transform; }
        .roulette-item { min-width: 90px; height: 90px; margin: 0 4px; background: #151515; border-radius: 12px; border: 1px solid #222; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: all 0.3s; }
        .roulette-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: white; z-index: 10; transform: translateX(-50%); box-shadow: 0 0 10px white; }
        .p-tabs { background: #111; padding: 4px; border-radius: 12px; display: flex; margin-bottom: 15px; border: 1px solid #222; }
        .p-tab { flex: 1; text-align: center; padding: 8px 0; font-size: 12px; font-weight: 600; color: #666; border-radius: 8px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .p-tab.active { background: #2C2C2E; color: white; }

        /* Tasks Styles */
        .task-card { background: #151517; border-radius: 20px; padding: 16px; margin-bottom: 12px; border: 1px solid #2A2A2C; display: flex; align-items: center; justify-content: space-between; }
        .task-btn { background: var(--blue-btn); color: white; font-size: 11px; font-weight: 700; padding: 8px 16px; border-radius: 20px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); min-width: 80px; text-align: center; }

        /* Profile wallet styles */
        #page-profile {
            background: radial-gradient(circle at top, rgba(34, 197, 94, 0.25) 0%, transparent 55%), #020617;
        }
        .profile-card {
            background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.32), transparent 55%), radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.9), #020617);
            border-radius: 28px;
            box-shadow: 0 18px 60px rgba(0, 0, 0, 0.8);
        }
        .profile-avatar-ring {
            width: 72px;
            height: 72px;
            border-radius: 999px;
            padding: 3px;
            background: conic-gradient(from 220deg, var(--neon) 0, var(--neon) 38%, rgba(255,255,255,0.06) 40%, rgba(15,23,42,0.8) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6);
            position: relative;
        }
        .profile-avatar-inner {
            width: 100%;
            height: 100%;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 0%, rgba(148, 163, 184, 0.6), transparent 55%), #020617;
            border: 2px solid rgba(148, 163, 184, 0.4);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 26px;
        }
        .profile-badge {
            font-size: 10px;
            padding: 4px 10px;
            border-radius: 999px;
            background: radial-gradient(circle at top, #facc15, #f97316);
            color: #111827;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            box-shadow: 0 0 18px rgba(250, 204, 21, 0.5);
        }
        .profile-tabs-container {
            margin-top: 4px;
            margin-bottom: 4px;
        }
        .profile-tabs {
            display: inline-flex;
            padding: 4px;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(34, 197, 94, 0.35);
            box-shadow: 0 14px 40px rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(22px);
        }
        .profile-tab-btn {
            border-radius: 999px;
            padding: 7px 18px;
            font-size: 11px;
            font-weight: 600;
            color: #64748b;
            border: none;
            background: transparent;
            outline: none;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .profile-tab-btn.active {
            color: #e5fdf0;
            background: radial-gradient(circle at top, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.9));
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.55);
        }

        .empty-gift-icon {
            animation: giftFloat 3.2s ease-in-out infinite;
            transform-origin: center bottom;
        }
        @keyframes giftFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-6px) rotate(-3deg); }
        }

        .tab-content.profile-tab.active {
            animation: profileFadeIn 0.5s ease-out;
        }
        @keyframes profileFadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ */
        .case-card {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .case-card.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Crash —ç–∫—Ä–∞–Ω - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç */
        #crash-area {
            position: relative;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #16213e 100%);
            transition: background 0.3s ease;
        }
        /* –ú–∞—Å—Å–∏–≤–Ω–æ–µ –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –º–Ω–æ–∂–∏—Ç–µ–ª—è */
        #mult-display {
            text-shadow:
                0 0 10px rgba(57,255,20,0.55),
                0 0 28px rgba(57,255,20,0.45),
                0 0 60px rgba(57,255,20,0.25);
        }
        #rocket-heat {
            width: 140px;
            height: 140px;
            border-radius: 999px;
            filter: blur(18px);
            opacity: 0;
            transform: translate(-50%, 50%);
            will-change: left, bottom, opacity, background;
            pointer-events: none;
            mix-blend-mode: screen;
        }

        /* –ß–∞—Å—Ç–∏—Ü—ã –¥–ª—è —Ä–∞–∫–µ—Ç—ã */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            animation: particleFade 1s ease-out forwards;
        }
        @keyframes particleFade {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(0) translateY(-20px); }
        }

        /* –ü–ª–∞–≤–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ –º–Ω–æ–∂–∏—Ç–µ–ª—è */
        .mult-counter {
            transition: transform 0.1s ease-out;
        }
        .mult-counter.update {
            animation: numberPop 0.2s ease-out;
        }
        @keyframes numberPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –≤—Å—Ç—Ä—è—Å–∫–∏ –¥–ª—è –∫–µ–π—Å–∞ */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px) rotate(-1deg); }
            20%, 40%, 60%, 80% { transform: translateX(5px) rotate(1deg); }
        }
        .shake { animation: shake 0.5s ease-in-out; }
        /* Screen shake –¥–ª—è CRASH */
        @keyframes crashShake {
            0% { transform: translate3d(0, 0, 0); }
            12% { transform: translate3d(-8px, 6px, 0); }
            24% { transform: translate3d(7px, -6px, 0); }
            36% { transform: translate3d(-6px, -2px, 0); }
            48% { transform: translate3d(6px, 4px, 0); }
            60% { transform: translate3d(-5px, 3px, 0); }
            72% { transform: translate3d(5px, -3px, 0); }
            84% { transform: translate3d(-3px, 2px, 0); }
            100% { transform: translate3d(0, 0, 0); }
        }
        .crash-shake { animation: crashShake 650ms ease-out; }

        /* Futuristic space background */
        #space-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: radial-gradient(circle at 20% 0%, rgba(34,197,94,0.18), transparent 55%), #000;
            overflow: hidden;
            pointer-events: none;
        }
        .stars-layer {
            position: absolute;
            inset: -20%;
            background-repeat: repeat;
            opacity: 0.8;
            animation: starDrift 70s linear infinite;
            transform: translateZ(0);
        }
        .stars-sm {
            background-image:
                radial-gradient(1px 1px at 10px 20px, rgba(255,255,255,0.75), transparent),
                radial-gradient(1px 1px at 60px 80px, rgba(255,255,255,0.55), transparent),
                radial-gradient(1px 1px at 140px 120px, rgba(255,255,255,0.6), transparent);
            background-size: 180px 180px;
            animation-duration: 95s;
            opacity: 0.55;
        }
        .stars-md {
            background-image:
                radial-gradient(1.5px 1.5px at 30px 50px, rgba(255,255,255,0.85), transparent),
                radial-gradient(2px 2px at 110px 160px, rgba(255,255,255,0.7), transparent),
                radial-gradient(1.5px 1.5px at 160px 40px, rgba(255,255,255,0.65), transparent);
            background-size: 240px 240px;
            animation-duration: 75s;
            opacity: 0.7;
        }
        .stars-lg {
            background-image:
                radial-gradient(2.5px 2.5px at 70px 90px, rgba(255,255,255,0.95), transparent),
                radial-gradient(3px 3px at 200px 180px, rgba(255,255,255,0.75), transparent);
            background-size: 320px 320px;
            animation-duration: 60s;
            opacity: 0.55;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.15));
        }
        @keyframes starDrift {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-8%, 10%, 0); }
        }
        /* Perspective cyber-grid */
        .cyber-grid {
            position: absolute;
            left: 50%;
            bottom: -15%;
            width: 160%;
            height: 120%;
            transform: translateX(-50%) perspective(900px) rotateX(70deg);
            transform-origin: 50% 100%;
            background-image:
                linear-gradient(rgba(34,197,94,0.16) 1px, transparent 1px),
                linear-gradient(90deg, rgba(34,197,94,0.12) 1px, transparent 1px);
            background-size: 44px 44px;
            opacity: 0.25;
            animation: gridMove 18s linear infinite;
            filter: drop-shadow(0 0 22px rgba(34,197,94,0.22));
        }
        @keyframes gridMove {
            0% { background-position: 0 0, 0 0; }
            100% { background-position: 0 240px, 0 240px; }
        }
        /* Green blur blobs */
        .blob {
            position: absolute;
            width: 420px;
            height: 420px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, rgba(34,197,94,0.35), transparent 60%);
            filter: blur(70px);
            opacity: 0.55;
            mix-blend-mode: screen;
            animation: blobMove 24s ease-in-out infinite;
        }
        .blob.b1 { top: -120px; left: -160px; animation-duration: 28s; }
        .blob.b2 { top: 35%; right: -200px; animation-duration: 34s; }
        .blob.b3 { bottom: -180px; left: 20%; animation-duration: 30s; }
        @keyframes blobMove {
            0%, 100% { transform: translate3d(0,0,0) scale(1); }
            40% { transform: translate3d(70px, 40px, 0) scale(1.12); }
            70% { transform: translate3d(-55px, 60px, 0) scale(0.98); }
        }

        /* Stars shine effect (Telegram Stars) */
        .stars-icon, .stars-coin {
            position: relative;
            overflow: hidden;
        }
        .stars-icon::after, .stars-coin::after {
            content: '';
            position: absolute;
            inset: -60%;
            background: conic-gradient(from 0deg, transparent 0 70%, rgba(255,255,255,0.55) 80%, transparent 90%, transparent 100%);
            animation: starsShine 3.8s linear infinite;
            mix-blend-mode: screen;
            opacity: 0.85;
        }
        @keyframes starsShine {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Double animated avatar rings (profile) */
        .profile-avatar-ring {
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6);
        }
        .profile-avatar-ring::before,
        .profile-avatar-ring::after {
            content: '';
            position: absolute;
            inset: -6px;
            border-radius: 999px;
            background: conic-gradient(from 120deg, rgba(57,255,20,0.0) 0 15%, rgba(57,255,20,0.85) 25%, rgba(57,255,20,0.08) 45%, rgba(255,255,255,0.06) 70%, rgba(57,255,20,0.0) 100%);
            filter: blur(0px);
            opacity: 0.8;
            animation: ringCW 7s linear infinite;
            pointer-events: none;
        }
        .profile-avatar-ring::after {
            inset: -12px;
            opacity: 0.55;
            animation: ringCCW 10s linear infinite;
        }
        @keyframes ringCW { to { transform: rotate(360deg); } }
        @keyframes ringCCW { to { transform: rotate(-360deg); } }

        /* Hologram feel for profile card */
        .profile-card {
            position: relative;
        }
        .profile-card::after {
            content: '';
            position: absolute;
            inset: 0;
            background:
                repeating-linear-gradient(0deg, rgba(255,255,255,0.04) 0 1px, transparent 1px 7px),
                radial-gradient(circle at 30% 20%, rgba(34,197,94,0.22), transparent 55%),
                radial-gradient(circle at 70% 80%, rgba(147,197,253,0.10), transparent 55%);
            opacity: 0.35;
            mix-blend-mode: screen;
            pointer-events: none;
            animation: holoShift 6s ease-in-out infinite;
        }
        @keyframes holoShift {
            0%, 100% { filter: hue-rotate(0deg); transform: translateY(0); }
            50% { filter: hue-rotate(22deg); transform: translateY(-6px); }
        }

        /* –í—Å–ø—ã—à–∫–∏ –ø—Ä–∏ –≤—ã–ø–∞–¥–µ–Ω–∏–∏ —Ä–µ–¥–∫–æ–≥–æ –ø—Ä–∏–∑–∞ */
        .flash {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.8) 0%, transparent 70%);
            pointer-events: none;
            z-index: 9998;
            opacity: 0;
            animation: flashEffect 0.3s ease-out;
        }
        @keyframes flashEffect {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="space-bg" aria-hidden="true">
        <div class="stars-layer stars-sm"></div>
        <div class="stars-layer stars-md"></div>
        <div class="stars-layer stars-lg"></div>
        <div class="cyber-grid"></div>
        <div class="blob b1"></div>
        <div class="blob b2"></div>
        <div class="blob b3"></div>
    </div>

    <div id="loading-screen">
        <h1 class="font-tech text-4xl font-bold text-white tracking-widest">Orbit<span style="color:var(--blue-btn)">Up</span></h1>
        <div class="loading-bar-bg"><div class="loading-bar-fill" id="loader-fill"></div></div>
    </div>

    <header class="pt-3 px-5 flex justify-between items-center z-20 relative" style="padding-top: max(12px, env(safe-area-inset-top));">
        <div class="glass-panel rounded-xl py-2 px-3 flex items-center gap-3 border-l-2 border-[#39FF14]" id="balance-container">
            <div id="headerIcon" class="w-6 h-6 flex items-center justify-center"></div>
            <div class="flex flex-col leading-none">
                <span class="text-[8px] text-gray-400 font-bold uppercase tracking-wider mb-0.5">–ë–∞–ª–∞–Ω—Å</span>
                <span class="font-tech font-bold text-lg text-white" id="headerBalance">0</span>
            </div>
        </div>
        <div class="text-right">
            <p class="text-[8px] text-gray-500 uppercase font-bold mb-1">–£—Ä–æ–≤–µ–Ω—å 1</p>
            <div class="w-16 h-1.5 bg-gray-800 rounded-full overflow-hidden"><div class="h-full bg-white w-1/3 shadow-[0_0_10px_white]"></div></div>
        </div>
    </header>

    <main>
        <section id="page-crash" class="tab-content active">
            <div class="flex justify-center mb-4">
                <div class="crash-switch">
                    <button onclick="setCurrency('stars')" id="sw-stars" class="switch-opt active-s">STARS</button>
                    <button onclick="setCurrency('ton')" id="sw-ton" class="switch-opt">TON</button>
                </div>
            </div>
            <div id="crash-area" class="relative w-full h-72 bg-[#080808] rounded-[30px] border border-gray-800 mb-5 overflow-hidden flex flex-col items-center justify-center shadow-2xl">
                <div class="absolute inset-0" style="background-image: radial-gradient(#222 1px, transparent 1px); background-size: 24px 24px; opacity: 0.4;"></div>
                <div id="rocket-heat" class="absolute z-[6]" style="bottom: 10%; left: 10%;"></div>
                <div id="rocket" class="absolute text-5xl transition-all duration-75 ease-linear z-20" style="bottom: 10%; left: 10%; opacity: 0; filter: drop-shadow(0 0 10px rgba(57,255,20,0.35)) drop-shadow(0 0 22px rgba(255,255,255,0.15));">üöÄ</div>
                <div id="mult-display" class="relative z-10 text-6xl font-black font-tech text-white mult-counter">1.00x</div>
                <div id="game-status" class="relative z-10 text-[9px] text-gray-500 font-bold uppercase tracking-[0.2em] mt-2">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                <div id="timer-bar" class="absolute bottom-0 left-0 h-1.5 bg-[#39FF14] w-0 shadow-[0_0_10px_#39FF14] transition-all"></div>
                <canvas id="particles-canvas" class="absolute inset-0 pointer-events-none" style="z-index: 5;"></canvas>
            </div>
            <div class="glass-panel rounded-[24px] p-5">
                <div class="flex justify-between text-[9px] text-gray-500 font-bold uppercase mb-2">
                    <span>–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏</span><span id="min-bet-label" class="text-white">Min: 25</span>
                </div>
                <div class="flex gap-3">
                    <input id="betInput" type="number" class="w-full bg-[#050505] border border-gray-700 rounded-2xl p-4 text-center text-xl font-bold text-white outline-none focus:border-white transition" value="25">
                    <button onclick="handleBetClick()" id="crashBtn" class="w-1/2 action-btn neon-btn uppercase text-sm tracking-wider shadow-lg">–ñ–î–ò–¢–ï</button>
                </div>
            </div>
        </section>

        <section id="page-cases" class="tab-content">
            <div id="cases-list">
                <h2 class="text-center font-tech text-xl font-black uppercase text-white mb-6">Mystery Boxes</h2>
                <div class="grid gap-3">
                    <div onclick="openCaseView(3)" class="case-card glass-panel p-4 rounded-[24px] flex items-center gap-4 border border-gray-800 active:scale-95 transition cursor-pointer border-l-4 border-l-white">
                        <div class="w-16 h-16 rounded-2xl bg-white/10 flex items-center justify-center text-3xl">üìÖ</div>
                        <div class="flex-grow"><h3 class="font-bold text-lg text-white">–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π</h3><p class="text-[10px] text-gray-400">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ 24—á</p></div>
                        <span class="text-[9px] font-bold bg-white text-black px-3 py-1 rounded-full uppercase">Free</span>
                    </div>
                    <div onclick="openCaseView(0)" class="case-card glass-panel p-4 rounded-[24px] flex items-center gap-4 border border-gray-800 active:scale-95 transition cursor-pointer hover:border-green-500">
                        <div class="w-16 h-16 rounded-2xl bg-[#39FF14]/10 flex items-center justify-center text-3xl">üì¶</div>
                        <div class="flex-grow"><h3 class="font-bold text-lg">–ù–æ–≤–∏—á–æ–∫</h3><p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 15 Stars</p></div>
                        <span class="text-[9px] font-bold bg-[#39FF14] text-black px-3 py-1 rounded-full uppercase">–û—Ç–∫—Ä—ã—Ç—å</span>
                    </div>
                    <div onclick="openCaseView(1)" class="case-card glass-panel p-4 rounded-[24px] flex items-center gap-4 border border-gray-800 active:scale-95 transition cursor-pointer hover:border-blue-500">
                        <div class="w-16 h-16 rounded-2xl bg-[#0098EA]/10 flex items-center justify-center text-3xl">üíé</div>
                        <div class="flex-grow"><h3 class="font-bold text-lg">–¢—Ä–µ–π–¥–µ—Ä</h3><p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 0.5 TON</p></div>
                        <span class="text-[9px] font-bold bg-[#0098EA] text-white px-3 py-1 rounded-full uppercase">–û—Ç–∫—Ä—ã—Ç—å</span>
                    </div>
                </div>
            </div>
            <div id="case-roulette-view" class="hidden h-full flex flex-col">
                <button onclick="closeCaseView()" class="mb-6 text-[10px] font-bold text-gray-500 flex items-center gap-1 hover:text-white uppercase tracking-widest">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="flex-grow flex flex-col justify-center pb-20">
                    <h2 id="active-case-name" class="text-center text-3xl font-black font-tech mb-8 uppercase tracking-wider">Case</h2>
                    <div class="roulette-wrapper"><div class="roulette-marker"></div><div id="rouletteTrack" class="roulette-track"></div></div>
                    <div class="text-center mt-4">
                        <button onclick="spinRoulette()" id="spinBtn" class="w-full py-5 rounded-2xl font-black uppercase text-sm tracking-widest shadow-xl transition transform active:scale-95 text-black">–ö–†–£–¢–ò–¢–¨</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-tasks" class="tab-content">
            <h2 class="text-center font-tech text-xl font-black uppercase text-white mb-6">–ó–∞–¥–∞–Ω–∏—è</h2>
            
            <div class="glass-panel p-4 rounded-[24px] mb-4 border border-gray-800">
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-2xl">üì¢</span>
                    <h3 class="font-bold text-sm">–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ö–∞–Ω–∞–ª</h3>
                </div>
                <p class="text-[10px] text-gray-400 mb-3">–ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª, —á—Ç–æ–±—ã –±—ã—Ç—å –≤ –∫—É—Ä—Å–µ –Ω–æ–≤–æ—Å—Ç–µ–π.</p>
                <div class="flex justify-between items-center bg-[#111] p-2 rounded-xl">
                    <div class="flex items-center gap-2">
                        <span class="text-[#FFD700]">‚≠ê</span>
                        <span class="text-sm font-bold">+1 Stars</span>
                    </div>
                    <button onclick="handleTask()" class="task-btn">–í–´–ü–û–õ–ù–ò–¢–¨</button>
                </div>
            </div>

            <div class="glass-panel p-4 rounded-[24px] mb-4 border border-gray-800">
                <div class="flex items-center gap-3 mb-2">
                    <span class="text-2xl">üí¨</span>
                    <h3 class="font-bold text-sm">–í—Å—Ç—É–ø–∏—Ç—å –≤ –ß–∞—Ç</h3>
                </div>
                <p class="text-[10px] text-gray-400 mb-3">–í—Å—Ç—É–ø–∞–π –≤ –Ω–∞—à —á–∞—Ç –∏ –æ–±—â–∞–π—Å—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–≥—Ä–æ–∫–∞–º–∏.</p>
                <div class="flex justify-between items-center bg-[#111] p-2 rounded-xl">
                    <div class="flex items-center gap-2">
                        <span class="text-[#FFD700]">‚≠ê</span>
                        <span class="text-sm font-bold">+1 Stars</span>
                    </div>
                    <button onclick="handleTask()" class="task-btn">–í–´–ü–û–õ–ù–ò–¢–¨</button>
                </div>
            </div>

            <div class="text-center mt-8 text-gray-600 text-[10px]">
                –ù–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è —Å–∫–æ—Ä–æ...
            </div>
        </section>

        <section id="page-profile" class="tab-content profile-tab">
            <div class="glass-panel profile-card p-5 rounded-[28px] mb-4 relative overflow-hidden">
                <div class="flex items-center gap-4 relative z-10">
                    <div class="profile-avatar-ring">
                        <div class="profile-avatar-inner">
                            <img id="user-avatar" src="" class="w-full h-full object-cover hidden">
                            <span id="user-avatar-placeholder">üë§</span>
                        </div>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                            <h2 class="text-[18px] font-bold text-white" id="user-name">Guest</h2>
                            <span class="profile-badge">VIP</span>
                        </div>
                        <div class="flex items-center justify-between mt-1 text-[10px] text-gray-400">
                            <p>ID: <span id="user-id">...</span></p>
                            <p class="uppercase tracking-[0.16em] text-[9px] text-emerald-300/80">LEVEL 1</p>
                        </div>
                    </div>
                </div>

                <div class="mt-5 flex items-center justify-between gap-4 relative z-10">
                    <div class="flex items-center gap-3">
                        <div class="w-9 h-9 rounded-2xl bg-[#020617] border border-emerald-500/40 flex items-center justify-center text-2xl shadow-[0_0_20px_rgba(16,185,129,0.4)] stars-coin">
                            ‚≠ê
                        </div>
                        <div>
                            <p class="text-[9px] uppercase tracking-[0.16em] text-emerald-200/80 mb-0.5">–ë–∞–ª–∞–Ω—Å Stars</p>
                            <div class="flex items-baseline gap-1">
                                <span id="profile-stars-balance" class="font-tech text-2xl font-black text-white">0</span>
                                <span class="text-[10px] text-gray-500 font-semibold tracking-[0.16em] uppercase">STARS</span>
                            </div>
                        </div>
                    </div>
                    <button onclick="openWallet('dep')" class="primary-btn px-4 py-3 text-[11px] font-bold uppercase tracking-wide whitespace-nowrap">
                        –ü–æ–ø–æ–ª–Ω–∏—Ç—å
                    </button>
                </div>
            </div>

            <div class="bg-gradient-to-r from-[#022c22] via-[#052e2b] to-[#047857] rounded-2xl p-4 mb-5 text-center shadow-xl relative overflow-hidden border border-emerald-500/40">
                <h3 class="font-bold text-sm text-white mb-1 relative z-10">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π</h3>
                <p class="text-[10px] text-emerald-100/90 mb-3 relative z-10">10% –æ—Ç –∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Ç–≤–æ–∏ –≤ –≤–∏–¥–µ Stars</p>
                <button onclick="shareLink()" class="bg-white/10 border border-emerald-200/40 text-white text-xs font-bold px-6 py-2 rounded-full w-full backdrop-blur-sm relative z-10 hover:bg-white/20 transition">
                    –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π
                </button>
            </div>

            <div class="profile-tabs-container flex justify-center">
                <div class="profile-tabs">
                    <button class="profile-tab-btn active" onclick="switchTab('gifts', this)">–ü–æ–¥–∞—Ä–∫–∏</button>
                    <button class="profile-tab-btn" onclick="switchTab('friends', this)">–î—Ä—É–∑—å—è</button>
                    <button class="profile-tab-btn" onclick="switchTab('history', this)">–ò—Å—Ç–æ—Ä–∏—è</button>
                </div>
            </div>

            <div id="tab-gifts" class="mt-5">
                <div class="glass-panel rounded-3xl py-8 px-4 mb-4 border border-dashed border-emerald-500/25 bg-gradient-to-b from-[#020617]/60 to-[#020815]/80">
                    <div class="relative flex flex-col items-center">
                        <div class="empty-gift-icon mb-4">
                            <div class="w-16 h-16 md:w-20 md:h-20 rounded-[24px] bg-gradient-to-br from-[#020617] via-[#022c22] to-[#16a34a]/40 flex items-center justify-center shadow-[0_0_40px_rgba(34,197,94,0.35)]">
                                <span class="text-4xl opacity-80">üì¶</span>
                            </div>
                        </div>
                        <p class="text-xs text-gray-300 mb-1">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                        <p class="text-[10px] text-gray-500 text-center max-w-[230px]">–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –±–æ–∫—Å—ã –∏ –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π, —á—Ç–æ–±—ã —Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é —Ä–µ–¥–∫–∏—Ö –Ω–∞–≥—Ä–∞–¥.</p>
                    </div>
                </div>
                <button onclick="openGiftModal()" class="w-full primary-btn py-3.5 text-sm font-bold uppercase tracking-wide">–î–û–ë–ê–í–ò–¢–¨ –ü–û–î–ê–†–û–ö</button>
            </div>
            <div id="tab-friends" class="hidden mt-5 text-center">
                <p class="text-xs text-gray-400 mb-1">–£ –≤–∞—Å 0 –¥—Ä—É–∑–µ–π</p>
                <p class="text-[10px] text-gray-500">–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å—Å—ã–ª–∫–æ–π, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å –∫–∞–∂–¥–æ–≥–æ –¥–µ–ø–æ–∑–∏—Ç–∞.</p>
            </div>
            <div id="tab-history" class="hidden mt-5 space-y-2"></div>
        </section>
    </main>

    <nav class="nav-dock">
        <div onclick="alert('–°–∫–æ—Ä–æ')" class="nav-item"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><rect x="4" y="14" width="16" height="6" rx="2"/></svg><span>–õ–∏–¥–µ—Ä—ã</span></div>
        <div onclick="nav('cases')" id="nav-cases" class="nav-item"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></svg><span>–†–æ–∑—ã–≥—Ä—ã—à–∏</span></div>
        <div onclick="nav('crash')" id="nav-crash" class="nav-item active"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.48-.56.93-1.23 1.35-2h4.65c.96 0 1.88.38 2.59 1.06l.32.32a.75.75 0 0 0 1.06 0l2.12-2.12a.75.75 0 0 0 0-1.06l-.32-.32a3.68 3.68 0 0 0-1.06-2.59V8.15c.77-.42 1.44-.87 2-1.35 1.5-1.26 2-5 2-5s-3.74.5-5 2c-.48.56-.93 1.23-1.35 2H9.85c-.96 0-1.88-.38-2.59-1.06l-.32-.32a.75.75 0 0 0-1.06 0L3.76 6.54a.75.75 0 0 0 0 1.06l.32.32c.68.71 1.06 1.63 1.06 2.59v4.65c-.42.77-.87 1.44-1.35 2z"/></svg><span>–ò–≥—Ä–∞—Ç—å</span></div>
        <div onclick="nav('tasks')" id="nav-tasks" class="nav-item"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg><span>–ó–∞–¥–∞–Ω–∏—è</span></div>
        <div onclick="nav('profile')" id="nav-profile" class="nav-item"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>–ü—Ä–æ—Ñ–∏–ª—å</span></div>
    </nav>

    <div id="wallet-modal" class="hidden fixed inset-0 bg-black/90 z-[100] flex items-end">
        <div class="bg-[#1C1C1E] w-full rounded-t-[32px] p-6 pb-12 border-t border-gray-800" style="padding-bottom: max(48px, calc(48px + env(safe-area-inset-bottom)));">
            <div class="w-12 h-1 bg-gray-600 mx-auto rounded-full mb-6" onclick="document.getElementById('wallet-modal').classList.add('hidden')"></div>
            <h3 class="text-center font-bold text-white mb-6 uppercase tracking-widest text-lg" id="wallet-title">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
            
            <div class="flex gap-2 mb-6">
                <button onclick="switchWalletCurr('stars')" id="wc-stars" class="flex-1 py-3 rounded-xl border border-[#007AFF] bg-[#007AFF]/10 text-[#007AFF] font-bold text-xs transition">Stars</button>
                <button onclick="switchWalletCurr('ton')" id="wc-ton" class="flex-1 py-3 rounded-xl border border-gray-700 bg-transparent text-gray-500 font-bold text-xs transition">Crypto (TON)</button>
            </div>

            <div id="ton-area" class="hidden flex flex-col gap-4">
                <div class="text-center mb-2 text-xs text-gray-400">1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ Ton-–∫–æ—à–µ–ª–µ–∫</div>
                <div id="ton-connect-btn-wrap" class="w-full flex justify-center"></div>
                <div class="text-center mt-4 text-xs text-gray-400">2. –í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É TON –∏ –æ–ø–ª–∞—Ç–∏—Ç–µ</div>
                <input id="wallet-input-ton" type="number" placeholder="–°—É–º–º–∞ –≤ TON" class="w-full bg-black p-4 rounded-xl text-center text-white font-bold text-xl outline-none border border-[#333]">
                <button onclick="processTonPayment()" class="w-full primary-btn py-4 rounded-xl font-bold">–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ TON</button>
            </div>

            <div id="stars-area">
                <div class="text-center mb-4">
                    <p class="text-xs text-gray-400 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞–∫–µ—Ç Stars</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="buyStars(1)" class="bg-[#020617] py-4 rounded-xl border border-white/5 hover:border-yellow-500 transition text-white font-bold text-lg flex flex-col items-center">
                            <span>50 ‚≠ê</span><span class="text-[9px] text-gray-500 font-normal">Starter</span>
                        </button>
                        <button onclick="buyStars(2)" class="bg-[#020617] py-4 rounded-xl border border-white/5 hover:border-yellow-500 transition text-white font-bold text-lg flex flex-col items-center">
                            <span>100 ‚≠ê</span><span class="text-[9px] text-gray-500 font-normal">Gamer</span>
                        </button>
                        <button onclick="buyStars(3)" class="bg-[#020617] py-4 rounded-xl border border-white/5 hover:border-yellow-500 transition text-white font-bold text-lg flex flex-col items-center">
                            <span>500 ‚≠ê</span><span class="text-[9px] text-gray-500 font-normal">Whale</span>
                        </button>
                        <button onclick="buyStars(4)" class="bg-[#020617] py-4 rounded-xl border border-white/5 hover:border-yellow-500 transition text-white font-bold text-lg flex flex-col items-center">
                            <span>1000 ‚≠ê</span><span class="text-[9px] text-gray-500 font-normal">Galaxy</span>
                        </button>
                    </div>
                </div>
                <p class="text-[10px] text-gray-500 text-center">–û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Stars</p>
            </div>
        </div>
    </div>

    <div id="gift-modal" class="hidden fixed inset-0 bg-black/95 z-[100] flex flex-col justify-center px-6">
        <div class="bg-[#1C1C1E] rounded-3xl p-6 border border-gray-800 text-center relative">
            <button onclick="document.getElementById('gift-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-500 font-bold">‚úï</button>
            <div class="flex justify-center items-center gap-4 mb-6 mt-4">
                <div class="w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center text-3xl">üéÅ</div>
                <div class="text-gray-500">‚ûú</div>
                <div class="w-16 h-16 bg-blue-500/20 rounded-full flex items-center justify-center text-3xl">ü§ñ</div>
            </div>
            <h3 class="text-lg font-bold mb-2">–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–¥–∞—Ä–æ–∫ –±–æ—Ç—É</h3>
            <p class="text-xs text-gray-400 mb-6">–ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ –±–æ—Ç—É @GiftsToOrbitUp. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ.</p>
            <a href="https://t.me/GiftsToOrbitUp" target="_blank" class="w-full primary-btn py-4 rounded-xl font-bold uppercase tracking-wide mb-3">–ü–ï–†–ï–ô–¢–ò –ö –ë–û–¢–£</a>
        </div>
    </div>

    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://ton-connect.github.io/demo-dapp-with-react-ui/tonconnect-manifest.json', 
            buttonRootId: 'ton-connect-btn-wrap'
        });

        const MY_WALLET_ADDRESS = "UQBLYVXsKcTwo2vegPZKQkR3lFowRYa2IK5_6OC8sXOyMh0p"; 

        let state = { balances: { stars: 0, ton: 0.0 }, lastDaily: 0, history: [] };
        const saved = localStorage.getItem('orbitUpFinalV26');
        if(saved) { try { state = JSON.parse(saved); } catch(e){} }
        function saveState() { localStorage.setItem('orbitUpFinalV26', JSON.stringify(state)); }

        let activeCurr = 'stars', walletCurr = 'stars', walletMode = 'dep';
        let game = { state: 'waiting', mult: 1.0, crashAt: 0, myBet: 0, cashedOut: false };
        let activeCase = null;
        let particlesCanvas = null;
        let particlesCtx = null;
        let particles = [];
        let multCounterInterval = null;
        let currentMult = 1.0;
        let targetMult = 1.0;

        const casesData = [
            { id: 0, name: "–ù–æ–≤–∏—á–æ–∫", price: 15, curr: 'stars', color: '#39FF14', prizes: [5, 10, 15, 25, 50] },
            { id: 1, name: "–¢—Ä–µ–π–¥–µ—Ä", price: 0.5, curr: 'ton', color: '#0098EA', prizes: [0.1, 0.2, 0.5, 0.8, 1.5] },
            { id: 3, name: "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π", price: 0, curr: 'stars', color: '#FFFFFF', prizes: [2, 5, 5, 2, 10] }
        ];

        const iconTon = `<svg viewBox="0 0 48 48" fill="none" class="w-full h-full"><circle cx="24" cy="24" r="24" fill="#0098EA"/><path d="M24 11L14 28L24 40L34 28L24 11Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 28L24 18L34 28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M24 40V28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
        const iconStars = `<span class="text-xl stars-icon">‚≠ê</span>`;

        // –ü–∞–∫–µ—Ç—ã Stars (–¥–ª—è –±—ç–∫–µ–Ω–¥–∞ –∏ —Ñ—Ä–æ–Ω—Ç–∞)
        const starPackages = {
            1: { stars: 50,  label: 'Starter' },
            2: { stars: 100, label: 'Gamer' },
            3: { stars: 500, label: 'Whale' },
            4: { stars: 1000, label: 'Galaxy' }
        };

        // === –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –û–ü–õ–ê–¢–´ ===

        async function savePaymentOnBackend(payload) {
            try {
                await fetch('/save-payment.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch (e) {
                console.error('savePayment error', e);
            }
        }

        // –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ TON (TonConnect)
        async function handleTonPay(amount) {
            hapticFeedback('impact');
            const value = parseFloat(amount);
            if (!value || value <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É TON');
                return;
            }

            try {
                // –ï—Å–ª–∏ –∫–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω - –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª TonConnect
                if (!tonConnectUI.account) {
                    await tonConnectUI.openModal();
                    alert('–ü–æ–¥–∫–ª—é—á–∏—Ç–µ TON-–∫–æ—à–µ–ª–µ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É –æ–ø–ª–∞—Ç—ã.');
                    return;
                }

                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 600,
                    messages: [
                        {
                            address: MY_WALLET_ADDRESS, // TODO: –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –ø—Ä–æ–µ–∫—Ç–∞
                            amount: (value * 1000000000).toString()
                        }
                    ]
                };

                const result = await tonConnectUI.sendTransaction(transaction);

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–ª–∞—Ç–µ–∂–µ –Ω–∞ –±—ç–∫–µ–Ω–¥
                await savePaymentOnBackend({
                    type: 'ton',
                    amount: value,
                    userId: state.userId || null,
                    tx: result
                });

                alert('–ü–ª–∞—Ç—ë–∂ —á–µ—Ä–µ–∑ TON –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –û–∂–∏–¥–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —Å–µ—Ç–∏.');
            } catch (e) {
                console.error(e);
                alert('–û—à–∏–±–∫–∞ –∏–ª–∏ –æ—Ç–º–µ–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ TON');
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ Stars —á–µ—Ä–µ–∑ Telegram Stars
        async function buyStars(packageId) {
            hapticFeedback('impact');
            const pkg = starPackages[packageId];
            if (!pkg) {
                alert('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–∞–∫–µ—Ç Stars');
                return;
            }

            const tg = window.Telegram.WebApp;

            try {
                const resp = await fetch('/create-stars-invoice.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        packageId,
                        stars: pkg.stars,
                        userId: state.userId || null,
                        initData: tg.initData || null
                    })
                });

                const data = await resp.json().catch(() => null);
                if (!data || !data.invoiceLink) {
                    console.error('Bad response from create-stars-invoice.php', data);
                    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∏–Ω–≤–æ–π—Å Stars');
                    return;
                }

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞–∫–µ—Ç, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –æ–ø–ª–∞—Ç–∏–ª–æ—Å—å –≤ callback
                localStorage.setItem('pendingStarsPackageId', String(packageId));

                tg.openInvoice(data.invoiceLink);
                document.getElementById('wallet-modal').classList.add('hidden');
            } catch (e) {
                console.error(e);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞ Stars');
            }
        }

        // === –§–£–ù–ö–¶–ò–ò –ê–ù–ò–ú–ê–¶–ò–ô ===
        
        // –¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ—Ç–¥–∞—á–∞
        function hapticFeedback(type = 'impact') {
            try {
                const tg = window.Telegram?.WebApp;
                if (tg && tg.HapticFeedback) {
                    if (type === 'impact') {
                        tg.HapticFeedback.impactOccurred('medium');
                    } else if (type === 'success') {
                        tg.HapticFeedback.notificationOccurred('success');
                    } else if (type === 'error') {
                        tg.HapticFeedback.notificationOccurred('error');
                    }
                }
            } catch(e) {}
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è canvas –¥–ª—è —á–∞—Å—Ç–∏—Ü
        function initParticlesCanvas() {
            particlesCanvas = document.getElementById('particles-canvas');
            if (!particlesCanvas) return;
            particlesCtx = particlesCanvas.getContext('2d');
            const crashArea = document.getElementById('crash-area');
            if (crashArea) {
                particlesCanvas.width = crashArea.offsetWidth;
                particlesCanvas.height = crashArea.offsetHeight;
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü—ã
        function createParticle(x, y) {
            particles.push({
                x: x,
                y: y,
                vx: (Math.random() - 0.5) * 2,
                vy: -Math.random() * 3 - 1,
                life: 1.0,
                size: Math.random() * 3 + 2
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —á–∞—Å—Ç–∏—Ü
        function updateParticles() {
            if (!particlesCtx || !particlesCanvas) return;
            particlesCtx.clearRect(0, 0, particlesCanvas.width, particlesCanvas.height);
            
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.02;
                
                if (p.life > 0) {
                    particlesCtx.globalAlpha = p.life;
                    particlesCtx.fillStyle = `rgba(255, 255, 255, ${p.life})`;
                    particlesCtx.beginPath();
                    particlesCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    particlesCtx.fill();
                } else {
                    particles.splice(i, 1);
                }
            }
            
            if (particles.length > 0 || game.state === 'flying') {
                requestAnimationFrame(updateParticles);
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ —Ñ–æ–Ω–∞
        function updateCrashGradient(mult) {
            const crashArea = document.getElementById('crash-area');
            if (!crashArea) return;
            
            // –û—Ç —Å–∏–Ω–µ–≥–æ (1.0x) –∫ –∫—Ä–∞—Å–Ω–æ–º—É (–≤—ã—Å–æ–∫–∏–π –º–Ω–æ–∂–∏—Ç–µ–ª—å)
            const intensity = Math.min((mult - 1) / 5, 1); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–æ 0-1
            const r = Math.floor(10 + intensity * 100);
            const g = Math.floor(26 + intensity * 30);
            const b = Math.floor(46 - intensity * 46);
            
            crashArea.style.background = `linear-gradient(135deg, 
                rgb(${r}, ${g}, ${b}) 0%, 
                rgb(${Math.floor(r*0.8)}, ${Math.floor(g*0.7)}, ${Math.floor(b*0.6)}) 50%, 
                rgb(${Math.floor(r*0.6)}, ${Math.floor(g*0.5)}, ${Math.floor(b*0.4)}) 100%)`;
        }

        // –¢–µ–ø–ª–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –∑–∞ —Ä–∞–∫–µ—Ç–æ–π (green -> red)
        function updateRocketHeat(mult, leftPct, bottomPct) {
            const heat = document.getElementById('rocket-heat');
            if (!heat) return;
            const intensity = Math.min((mult - 1) / 4.5, 1);
            const green = Math.floor(185 - intensity * 80);
            const red = Math.floor(34 + intensity * 190);
            const alpha = 0.10 + intensity * 0.28;
            heat.style.left = leftPct + '%';
            heat.style.bottom = bottomPct + '%';
            heat.style.opacity = (0.0 + intensity * 0.95).toFixed(2);
            heat.style.background = `radial-gradient(circle at 40% 40%, rgba(${red}, ${green}, 70, ${alpha}) 0%, rgba(57,255,20, ${alpha * 0.65}) 35%, transparent 72%)`;
        }

        // –ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –º–Ω–æ–∂–∏—Ç–µ–ª—è
        function updateMultDisplaySmooth(newMult) {
            targetMult = newMult;
            const display = document.getElementById('mult-display');
            if (!display) return;
            
            if (multCounterInterval) clearInterval(multCounterInterval);
            
            multCounterInterval = setInterval(() => {
                if (currentMult < targetMult) {
                    currentMult = Math.min(currentMult + 0.01, targetMult);
                    display.innerText = currentMult.toFixed(2) + 'x';
                    display.classList.add('update');
                    setTimeout(() => display.classList.remove('update'), 200);
                    updateCrashGradient(currentMult);
                } else {
                    clearInterval(multCounterInterval);
                    multCounterInterval = null;
                }
            }, 50);
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
        function observeCaseCards() {
            const cards = document.querySelectorAll('.case-card');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            entry.target.classList.add('visible');
                        }, index * 100);
                    }
                });
            }, { threshold: 0.1 });
            
            cards.forEach(card => observer.observe(card));
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Å—Ç—Ä—è—Å–∫–∏ —ç–∫—Ä–∞–Ω–∞
        function shakeScreen() {
            document.body.classList.add('shake');
            setTimeout(() => {
                document.body.classList.remove('shake');
            }, 500);
        }

        // –í—Å–ø—ã—à–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∫–æ–º –ø—Ä–∏–∑–µ
        function flashScreen() {
            const flash = document.createElement('div');
            flash.className = 'flash';
            document.body.appendChild(flash);
            setTimeout(() => {
                flash.remove();
            }, 300);
        }

        window.onload = () => {
            const tg = window.Telegram.WebApp;
            tg.ready(); tg.expand();
            const user = tg.initDataUnsafe.user;
            if(user) {
                document.getElementById('user-name').innerText = user.first_name;
                document.getElementById('user-id').innerText = user.id;
                state.userId = user.id;
                if(user.photo_url) {
                    document.getElementById('user-avatar').src = user.photo_url;
                    document.getElementById('user-avatar').classList.remove('hidden');
                    document.getElementById('user-avatar-placeholder').classList.add('hidden');
                }
            }
            
            tg.onEvent('invoiceClosed', async (object) => {
                // –ö–æ–ª–±—ç–∫ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã Stars (—á–µ—Ä–µ–∑ openInvoice)
                if (object.status === 'paid') {
                    const pkgIdStr = localStorage.getItem('pendingStarsPackageId');
                    if (pkgIdStr) {
                        const pkgId = parseInt(pkgIdStr, 10);
                        const pkg = starPackages[pkgId];
                        try {
                            await savePaymentOnBackend({
                                type: 'stars',
                                packageId: pkgId,
                                stars: pkg ? pkg.stars : undefined,
                                userId: state.userId || null,
                                invoiceStatus: object.status
                            });
                            hapticFeedback('success');
                            alert('–û–ø–ª–∞—Ç–∞ Stars —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.');
                        } catch (e) {
                            console.error(e);
                        } finally {
                            localStorage.removeItem('pendingStarsPackageId');
                        }
                    }
                }
            });

            let fill = document.getElementById('loader-fill');
            setTimeout(() => fill.style.width = "100%", 100);
            setTimeout(() => { 
                document.getElementById('loading-screen').style.opacity=0; 
                setTimeout(()=> { 
                    document.getElementById('loading-screen').style.display='none'; 
                    initParticlesCanvas();
                    observeCaseCards();
                    startCrashLoop(); 
                }, 500); 
            }, 2000);
            
            updateHeader();
            updateHistoryUI();
        };

        // === TASKS (SAFE MODE) ===
        function handleTask() {
            hapticFeedback('impact');
            alert("–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ");
        }

        // === PAYMENT ===

        // === NAV ===
        function nav(page) {
            hapticFeedback('impact');
            if(page==='rating') return alert('–õ–∏–¥–µ—Ä—ã —Å–∫–æ—Ä–æ...');
            document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
            document.getElementById('page-'+page).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
            if(page === 'crash') document.getElementById('nav-crash').classList.add('active');
            if(page === 'cases') {
                document.getElementById('nav-cases').classList.add('active');
                setTimeout(observeCaseCards, 100);
            }
            if(page === 'tasks') document.getElementById('nav-tasks').classList.add('active');
            if(page === 'profile') document.getElementById('nav-profile').classList.add('active');
        }

        function updateHeader() {
            const iconContainer = document.getElementById('headerIcon');
            const balanceText = document.getElementById('headerBalance');
            const container = document.getElementById('balance-container');
            
            if(activeCurr === 'stars') {
                iconContainer.innerHTML = iconStars;
                balanceText.innerText = state.balances.stars.toFixed(0);
                balanceText.style.color = 'white';
                container.style.borderLeftColor = '#39FF14';
            } else {
                iconContainer.innerHTML = iconTon;
                balanceText.innerText = state.balances.ton.toFixed(2);
                balanceText.style.color = '#0098EA';
                container.style.borderLeftColor = '#0098EA';
            }

            // –ü—Ä–æ—Ñ–∏–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å Stars
            const profileStars = document.getElementById('profile-stars-balance');
            if (profileStars) {
                profileStars.innerText = state.balances.stars.toFixed(0);
            }
        }

        function setCurrency(c) {
            hapticFeedback('impact');
            activeCurr = c;
            if(c==='stars') {
                document.getElementById('sw-stars').className="switch-opt active-s";
                document.getElementById('sw-ton').className="switch-opt";
                document.getElementById('min-bet-label').innerText = "Min: 25 Stars";
                document.getElementById('betInput').value = 25;
            } else {
                document.getElementById('sw-ton').className="switch-opt active-t";
                document.getElementById('sw-stars').className="switch-opt";
                document.getElementById('min-bet-label').innerText = "Min: 0.1 TON";
                document.getElementById('betInput').value = 0.1;
            }
            updateHeader();
            updateBtn();
        }

        function shareLink() {
            hapticFeedback('impact');
            const url = "https://t.me/share/url?url=https://t.me/orbitupbot&text=–ü–æ–ª—É—á–∞–π –ó–≤–µ–∑–¥—ã –ë–µ—Å–ø–ª–∞—Ç–Ω–æ! –≤ –±–æ—Ç–µ @OrbitUpBot";
            window.Telegram.WebApp.openTelegramLink(url);
        }

        // === CRASH ===
        function startCrashLoop() {
            game.state = 'waiting'; game.myBet = 0; game.cashedOut = false; game.mult = 1.0;
            currentMult = 1.0;
            targetMult = 1.0;
            document.getElementById('mult-display').innerText = "1.00x";
            document.getElementById('mult-display').className = "relative z-10 text-6xl font-black font-tech text-white mult-counter";
            document.getElementById('mult-display').classList.remove('text-red-600', 'text-[#39FF14]');
            document.getElementById('game-status').innerText = "–û–ñ–ò–î–ê–ù–ò–ï...";
            document.getElementById('rocket').style.opacity = '0';
            const heat = document.getElementById('rocket-heat');
            if (heat) heat.style.opacity = '0';
            particles = [];
            updateCrashGradient(1.0);
            const bar = document.getElementById('timer-bar');
            bar.style.transition = 'none'; bar.style.width = '100%';
            setTimeout(() => { bar.style.transition = 'width 5s linear'; bar.style.width = '0%'; }, 100);
            updateBtn();
            setTimeout(launchRocket, 5000);
        }

        function launchRocket() {
            hapticFeedback('impact');
            game.state = 'flying';
            document.getElementById('game-status').innerText = "–ü–û–õ–ï–¢";
            document.getElementById('rocket').style.opacity = '1';
            let r = Math.random();
            if (r < 0.30) game.crashAt = 1.00 + Math.random() * 0.20; 
            else if (r < 0.70) game.crashAt = 1.20 + Math.random() * 0.40;
            else if (r < 0.90) game.crashAt = 1.60 + Math.random() * 0.90;
            else game.crashAt = 2.50 + Math.random() * 4.0;
            updateBtn();
            updateParticles();
            
            let loop = setInterval(() => {
                if(game.state !== 'flying') { clearInterval(loop); return; }
                game.mult += 0.01;
                updateMultDisplaySmooth(game.mult);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Å—Ç–∏—Ü –∑–∞ —Ä–∞–∫–µ—Ç–æ–π
                const rocket = document.getElementById('rocket');
                if (rocket && Math.random() > 0.7) {
                    const rect = rocket.getBoundingClientRect();
                    const crashArea = document.getElementById('crash-area');
                    const crashRect = crashArea.getBoundingClientRect();
                    createParticle(
                        rect.left - crashRect.left + rect.width / 2,
                        rect.top - crashRect.top + rect.height
                    );
                }
                
                let p = Math.min(80, (game.mult - 1) * 30);
                const bottomPct = (10 + p/2);
                const leftPct = (10 + p);
                document.getElementById('rocket').style.bottom = bottomPct + '%';
                document.getElementById('rocket').style.left = leftPct + '%';
                updateRocketHeat(game.mult, leftPct, bottomPct);
                
                if(game.mult >= game.crashAt) { 
                    clearInterval(loop); 
                    doCrash(); 
                }
            }, 50);
        }

        function doCrash() {
            hapticFeedback('error');
            game.state = 'crashed';
            // screen shake –≤ –º–æ–º–µ–Ω—Ç –≤–∑—Ä—ã–≤–∞
            document.body.classList.add('crash-shake');
            setTimeout(() => document.body.classList.remove('crash-shake'), 700);
            document.getElementById('mult-display').classList.add('text-red-600');
            document.getElementById('mult-display').innerText = "CRASHED";
            document.getElementById('rocket').style.opacity = '0';
            const heat = document.getElementById('rocket-heat');
            if (heat) heat.style.opacity = '0';
            updateBtn();
            setTimeout(startCrashLoop, 2000);
        }

        function handleBetClick() {
            hapticFeedback('impact');
            if(game.state === 'waiting') {
                if(game.myBet > 0) return;
                let val = parseFloat(document.getElementById('betInput').value);
                let min = activeCurr === 'stars' ? 25 : 0.1;
                if(val < min) return alert("–ú–∏–Ω: " + min);
                if(val > state.balances[activeCurr]) return alert("–ú–∞–ª–æ —Å—Ä–µ–¥—Å—Ç–≤");
                state.balances[activeCurr] -= val;
                game.myBet = val;
                saveState(); updateHeader(); updateBtn();
            } else if(game.state === 'flying' && game.myBet > 0 && !game.cashedOut) {
                hapticFeedback('success');
                let win = game.myBet * game.mult;
                state.balances[activeCurr] += win;
                game.cashedOut = true;
                addHistory('Crash', win, 'win');
                document.getElementById('mult-display').classList.add('text-[#39FF14]');
                saveState(); updateHeader(); updateBtn();
            }
        }

        function updateBtn() {
            const btn = document.getElementById('crashBtn');
            if(game.state === 'waiting') {
                if(game.myBet > 0) { btn.innerText = "–°–¢–ê–í–ö–ê –ü–†–ò–ù–Ø–¢–ê"; btn.className = "w-1/2 action-btn bg-gray-800 text-gray-500 text-xs"; btn.disabled = true; }
                else { btn.innerText = "–°–¢–ê–†–¢"; btn.className = activeCurr === 'stars' ? 'w-1/2 action-btn neon-btn uppercase text-sm tracking-wider shadow-lg' : 'w-1/2 action-btn ton-btn uppercase text-sm tracking-wider shadow-lg'; btn.disabled = false; }
            } else if (game.state === 'flying') {
                if(game.myBet > 0 && !game.cashedOut) { btn.innerText = "–ó–ê–ë–†–ê–¢–¨"; btn.className = "w-1/2 action-btn bg-white text-black text-sm font-black shadow-[0_0_20px_white]"; btn.disabled = false; }
                else if (game.cashedOut) { btn.innerText = "–í–´–ò–ì–†–´–®"; btn.className = "w-1/2 action-btn bg-[#39FF14] text-black text-xs font-bold"; btn.disabled = true; }
                else { btn.innerText = "–ò–î–ï–¢ –ò–ì–†–ê"; btn.className = "w-1/2 action-btn bg-gray-800 text-gray-500 text-xs"; btn.disabled = true; }
            } else {
                btn.innerText = "–ö–†–£–®–ï–ù–ò–ï"; btn.className = "w-1/2 action-btn bg-red-900 text-white text-xs"; btn.disabled = true;
            }
        }

        // === CASES ===
        function openCaseView(id) {
            hapticFeedback('impact');
            activeCase = casesData.find(c => c.id === id);
            if(activeCase.id === 3) {
                const now = Date.now();
                if(now - state.lastDaily < 86400000) return alert('–ë–æ–Ω—É—Å –¥–æ—Å—Ç—É–ø–µ–Ω —Ä–∞–∑ –≤ 24 —á–∞—Å–∞!');
            }
            document.getElementById('cases-list').classList.add('hidden');
            document.getElementById('case-roulette-view').classList.remove('hidden');
            document.getElementById('active-case-name').innerText = activeCase.name;
            document.getElementById('active-case-name').style.color = activeCase.color;
            const btn = document.getElementById('spinBtn');
            btn.innerText = activeCase.price === 0 ? "–ö–†–£–¢–ò–¢–¨ –ë–ï–°–ü–õ–ê–¢–ù–û" : `–ö–†–£–¢–ò–¢–¨ –ó–ê ${activeCase.price} ${activeCase.curr.toUpperCase()}`;
            btn.style.backgroundColor = activeCase.color;
            btn.disabled = false;
            initRoulette();
        }

        function initRoulette() {
            const track = document.getElementById('rouletteTrack');
            track.innerHTML = '';
            for(let i=0; i<60; i++) {
                let p = activeCase.prizes[Math.floor(Math.random()*activeCase.prizes.length)];
                let d = document.createElement('div');
                d.className = 'roulette-item';
                d.innerHTML = `<span class="text-xs font-bold text-gray-500">${p}</span>`;
                track.appendChild(d);
            }
            track.style.transition = 'none'; track.style.transform = 'translateX(0)';
        }

        function spinRoulette() {
            hapticFeedback('impact');
            if(activeCase.price > 0 && state.balances[activeCase.curr] < activeCase.price) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
            if(activeCase.price > 0) state.balances[activeCase.curr] -= activeCase.price;
            saveState(); updateHeader();
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            
            // –í—Å—Ç—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞
            shakeScreen();
            
            const track = document.getElementById('rouletteTrack');
            let r = Math.random();
            let winIdx = r < 0.5 ? 0 : (r < 0.8 ? 1 : (r < 0.95 ? 2 : 4));
            if(winIdx >= activeCase.prizes.length) winIdx = 0;
            let winAmount = activeCase.prizes[winIdx];
            let targetIdx = 45; 
            track.children[targetIdx].innerHTML = `<span class="text-xl font-bold text-white">${winAmount}</span>`;
            track.children[targetIdx].style.background = activeCase.color;
            if(activeCase.color === '#FFFFFF') track.children[targetIdx].style.color = 'black';
            let offset = (targetIdx * 98) - (track.parentElement.offsetWidth / 2) + 49;
            track.style.transition = 'transform 4s cubic-bezier(0.1,0,0,1)';
            track.style.transform = `translateX(-${offset}px)`;
            
            setTimeout(() => {
                state.balances[activeCase.curr] += winAmount;
                if(activeCase.id === 3) state.lastDaily = Date.now();
                addHistory('Case', winAmount, 'win');
                saveState(); updateHeader();
                
                // –í—Å–ø—ã—à–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∫–æ–º –ø—Ä–∏–∑–µ (–µ—Å–ª–∏ –≤—ã–∏–≥—Ä—ã—à –±–æ–ª—å—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ)
                const avgPrize = activeCase.prizes.reduce((a, b) => a + b, 0) / activeCase.prizes.length;
                if (winAmount > avgPrize * 1.5) {
                    flashScreen();
                    hapticFeedback('success');
                } else {
                    hapticFeedback('success');
                }
                
                alert(`–í—ã–∏–≥—Ä—ã—à: ${winAmount}`);
                btn.disabled = false;
                closeCaseView();
            }, 4200);
        }

        function closeCaseView() {
            document.getElementById('case-roulette-view').classList.add('hidden');
            document.getElementById('cases-list').classList.remove('hidden');
        }

        // === WALLET & REAL TON ===
        function openWallet(mode) {
            hapticFeedback('impact');
            walletMode = mode;
            document.getElementById('wallet-modal').classList.remove('hidden'); 
            document.getElementById('wallet-title').innerText = mode === 'dep' ? "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ" : "–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤";
            switchWalletCurr('stars'); 
        }
        function openGiftModal() {
            hapticFeedback('impact');
            document.getElementById('gift-modal').classList.remove('hidden'); 
        }
        
        function switchWalletCurr(c) {
            hapticFeedback('impact');
            walletCurr = c;
            if(c==='stars') {
                document.getElementById('wc-stars').className="flex-1 py-3 rounded-xl border border-[#007AFF] bg-[#007AFF]/10 text-[#007AFF] font-bold text-xs transition";
                document.getElementById('wc-ton').className="flex-1 py-3 rounded-xl border border-gray-700 bg-transparent text-gray-500 font-bold text-xs transition";
                document.getElementById('stars-area').classList.remove('hidden');
                document.getElementById('ton-area').classList.add('hidden');
            } else {
                document.getElementById('wc-ton').className="flex-1 py-3 rounded-xl border border-[#007AFF] bg-[#007AFF]/10 text-[#007AFF] font-bold text-xs transition";
                document.getElementById('wc-stars').className="flex-1 py-3 rounded-xl border border-gray-700 bg-transparent text-gray-500 font-bold text-xs transition";
                if(walletMode === 'dep') {
                    document.getElementById('stars-area').classList.add('hidden');
                    document.getElementById('ton-area').classList.remove('hidden');
                } else {
                    document.getElementById('stars-area').classList.remove('hidden'); 
                    document.getElementById('ton-area').classList.add('hidden');
                }
            }
        }

        async function processTonPayment() {
            const amount = parseFloat(document.getElementById('wallet-input-ton').value);
            if(!amount || amount <= 0) {
                alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É TON");
                return;
            }
            await handleTonPay(amount);
        }

        function switchTab(t, btn) {
            hapticFeedback('impact');
            document.querySelectorAll('#tab-gifts, #tab-friends, #tab-history').forEach(e=>e.classList.add('hidden'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.querySelectorAll('.profile-tab-btn').forEach(e=>e.classList.remove('active'));
            btn.classList.add('active');
        }
        function addHistory(gameName, amount, type) {
            state.history.unshift({ game: gameName, amount: amount, type: type, time: new Date().toLocaleTimeString().slice(0,5) });
            if(state.history.length > 5) state.history.pop();
            updateHistoryUI();
        }
        function updateHistoryUI() {
            const div = document.getElementById('tab-history');
            div.innerHTML = '';
            state.history.forEach(h => {
                div.innerHTML += `
                <div class="glass-panel p-3 rounded-xl flex justify-between items-center mb-2">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-green-500/20 text-green-500 flex items-center justify-center text-xs font-bold">W</div>
                        <div><p class="text-xs font-bold">${h.game}</p><p class="text-[9px] text-gray-500">${h.time}</p></div>
                    </div>
                    <span class="text-green-500 text-xs font-bold">+${h.amount.toFixed(2)}</span>
                </div>`;
            });
        }
    </script>
</body>
</html>
