<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OrbitUp Ultimate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600;700&display=swap');
        
        :root { --neon: #39FF14; --ton: #0098EA; --bg: #050505; --blue-orbit: #007AFF; }

        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; margin: 0; user-select: none; }
        
        .font-tech { font-family: 'Orbitron', sans-serif; }
        
        /* Loading Screen */
        #loading-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-col; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .loader-spin { width: 40px; height: 40px; border: 4px solid #333; border-top-color: var(--blue-orbit); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Glass & Panels */
        .glass-panel { background: rgba(20, 20, 20, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 4px 20px rgba(0,0,0,0.5); }
        
        /* OrbitUp Profile Card */
        .orbit-card { background: #1C1C1E; border-radius: 20px; }
        .orbit-btn { background: var(--blue-orbit); color: white; font-weight: 700; border-radius: 14px; transition: 0.2s; }
        .orbit-btn:active { opacity: 0.8; transform: scale(0.98); }

        /* Tabs in Profile */
        .p-tabs { background: #111; padding: 4px; border-radius: 12px; display: flex; }
        .p-tab { flex: 1; text-align: center; padding: 8px 0; font-size: 13px; font-weight: 600; color: #888; border-radius: 8px; transition: 0.2s; }
        .p-tab.active { background: #2C2C2E; color: white; }

        /* Crash Elements */
        .neon-btn { background: var(--neon); color: black; box-shadow: 0 0 15px rgba(57, 255, 20, 0.3); }
        .ton-btn { background: var(--ton); color: white; box-shadow: 0 0 15px rgba(0, 152, 234, 0.3); }
        .action-btn { font-weight: 800; border-radius: 14px; transition: 0.1s; }
        .action-btn:active { transform: scale(0.95); }

        /* Nav Dock */
        .nav-dock {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 380px;
            background: rgba(15, 15, 15, 0.95); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 24px;
            display: flex; justify-content: space-around; padding: 10px 0; z-index: 50;
        }
        .nav-item { color: #555; padding: 8px; border-radius: 12px; transition: 0.3s; }
        .nav-item.active { color: white; }
        .nav-item.active svg { filter: drop-shadow(0 0 6px white); }

        /* Content Area */
        .tab-content { display: none; height: calc(100vh - 90px); overflow-y: auto; padding: 20px; padding-bottom: 120px; }
        .tab-content.active { display: block; animation: fadeUp 0.3s ease; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Roulette */
        .roulette-wrapper { position: relative; width: 100%; height: 110px; background: #000; border-radius: 16px; overflow: hidden; border: 1px solid #333; margin-bottom: 20px; }
        .roulette-track { display: flex; position: absolute; height: 100%; align-items: center; left: 0; will-change: transform; }
        .roulette-item { min-width: 90px; height: 90px; margin: 0 4px; background: #151515; border-radius: 12px; border: 1px solid #222; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .roulette-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: white; z-index: 10; transform: translateX(-50%); box-shadow: 0 0 10px white; }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="flex flex-col items-center">
            <h1 class="font-tech text-3xl font-bold text-white mb-2">Orbit<span style="color:var(--blue-orbit)">Up</span></h1>
            <p class="text-xs text-gray-500 mb-6">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</p>
            <div class="loader-spin"></div>
        </div>
    </div>

    <header class="pt-3 px-5 flex justify-between items-center z-20 relative">
        <div onclick="nav('profile')" class="glass-panel rounded-xl py-2 px-3 flex items-center gap-3 cursor-pointer active:scale-95 transition border-l-2 border-[#39FF14]" id="balance-container">
            <div id="headerIcon" class="w-6 h-6 flex items-center justify-center"></div>
            <div class="flex flex-col leading-none">
                <span class="text-[8px] text-gray-400 font-bold uppercase tracking-wider mb-0.5">–ë–∞–ª–∞–Ω—Å</span>
                <span class="font-tech font-bold text-lg text-white" id="headerBalance">0</span>
            </div>
        </div>
        <div class="text-right">
            <p class="text-[8px] text-gray-500 uppercase font-bold mb-1">LEVEL 1</p>
            <div class="w-16 h-1.5 bg-gray-800 rounded-full overflow-hidden">
                <div class="h-full bg-white w-1/3 shadow-[0_0_10px_white]"></div>
            </div>
        </div>
    </header>

    <main>
        <section id="page-crash" class="tab-content active">
            <div class="flex justify-center mb-4">
                <div class="bg-[#111] rounded-xl p-1 flex gap-1 border border-[#333]">
                    <button onclick="setCurrency('stars')" id="sw-stars" class="px-4 py-2 rounded-lg text-[10px] font-bold bg-[#333] text-white">STARS</button>
                    <button onclick="setCurrency('ton')" id="sw-ton" class="px-4 py-2 rounded-lg text-[10px] font-bold text-gray-500">TON</button>
                </div>
            </div>

            <div class="relative w-full h-72 bg-[#080808] rounded-[30px] border border-gray-800 mb-5 overflow-hidden flex flex-col items-center justify-center shadow-2xl">
                <div class="absolute inset-0" style="background-image: radial-gradient(#222 1px, transparent 1px); background-size: 24px 24px; opacity: 0.4;"></div>
                <div id="rocket" class="absolute text-5xl transition-all duration-100 ease-linear" style="bottom: 10%; left: 10%; opacity: 0;">üöÄ</div>
                <div id="mult-display" class="relative z-10 text-6xl font-black font-tech text-white transition-transform">1.00x</div>
                <div id="game-status" class="relative z-10 text-[9px] text-gray-500 font-bold uppercase tracking-[0.2em] mt-2">–û–∂–∏–¥–∞–Ω–∏–µ...</div>
                <div id="timer-bar" class="absolute bottom-0 left-0 h-1.5 bg-white w-0 shadow-[0_0_10px_white]"></div>
            </div>

            <div class="glass-panel rounded-[24px] p-5">
                <div class="flex justify-between text-[9px] text-gray-500 font-bold uppercase mb-2">
                    <span>–°—Ç–∞–≤–∫–∞</span>
                    <span id="min-bet-label" class="text-white">Min: 25</span>
                </div>
                <div class="flex gap-3">
                    <input id="betInput" type="number" class="w-full bg-[#050505] border border-gray-700 rounded-2xl p-4 text-center text-xl font-bold text-white outline-none focus:border-white transition" value="25">
                    <button onclick="handleBetClick()" id="crashBtn" class="w-1/2 action-btn neon-btn uppercase text-sm tracking-wider shadow-lg">–°–¢–ê–†–¢</button>
                </div>
            </div>
        </section>

        <section id="page-cases" class="tab-content">
            <div id="cases-list">
                <h2 class="text-center font-tech text-xl font-black uppercase text-white mb-6">Mystery Boxes</h2>
                <div class="grid gap-3">
                    <div onclick="openCaseView(0)" class="glass-panel p-4 rounded-[24px] flex items-center gap-4 border border-gray-800 active:scale-95 transition cursor-pointer">
                        <div class="w-16 h-16 rounded-2xl bg-[#39FF14]/10 flex items-center justify-center text-3xl">üì¶</div>
                        <div class="flex-grow">
                            <h3 class="font-bold text-lg">–ù–æ–≤–∏—á–æ–∫</h3>
                            <p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 15 Stars</p>
                        </div>
                        <div class="text-right">
                            <span class="text-[9px] font-bold bg-[#39FF14] text-black px-3 py-1 rounded-full">–û—Ç–∫—Ä—ã—Ç—å</span>
                        </div>
                    </div>
                    <div onclick="openCaseView(1)" class="glass-panel p-4 rounded-[24px] flex items-center gap-4 border border-gray-800 active:scale-95 transition cursor-pointer">
                        <div class="w-16 h-16 rounded-2xl bg-[#0098EA]/10 flex items-center justify-center text-3xl">üíé</div>
                        <div class="flex-grow">
                            <h3 class="font-bold text-lg">–¢—Ä–µ–π–¥–µ—Ä</h3>
                            <p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 0.5 TON</p>
                        </div>
                        <div class="text-right">
                            <span class="text-[9px] font-bold bg-[#0098EA] text-white px-3 py-1 rounded-full">–û—Ç–∫—Ä—ã—Ç—å</span>
                        </div>
                    </div>
                    <div onclick="openCaseView(2)" class="glass-panel p-4 rounded-[24px] flex items-center gap-4 border border-gray-800 active:scale-95 transition cursor-pointer">
                        <div class="w-16 h-16 rounded-2xl bg-yellow-500/10 flex items-center justify-center text-3xl">üëë</div>
                        <div class="flex-grow">
                            <h3 class="font-bold text-lg text-yellow-500">–ú–∞–≥–Ω–∞—Ç</h3>
                            <p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 100 Stars</p>
                        </div>
                        <div class="text-right">
                            <span class="text-[9px] font-bold bg-yellow-500 text-black px-3 py-1 rounded-full">–û—Ç–∫—Ä—ã—Ç—å</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="case-roulette-view" class="hidden h-full flex flex-col">
                <button onclick="closeCaseView()" class="mb-6 text-[10px] font-bold text-gray-500 flex items-center gap-1 hover:text-white uppercase tracking-widest">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="flex-grow flex flex-col justify-center pb-20">
                    <h2 id="active-case-name" class="text-center text-3xl font-black font-tech mb-8 uppercase tracking-wider">Case</h2>
                    <div class="roulette-wrapper">
                        <div class="roulette-marker"></div>
                        <div id="rouletteTrack" class="roulette-track"></div>
                    </div>
                    <div class="text-center mt-4">
                        <button onclick="spinRoulette()" id="spinBtn" class="w-full py-5 rounded-2xl font-black uppercase text-sm tracking-widest shadow-xl transition transform active:scale-95 text-black">–ö–†–£–¢–ò–¢–¨</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-profile" class="tab-content">
            <div class="orbit-card p-5 mb-4 relative overflow-hidden">
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-14 h-14 rounded-full bg-gray-700 border-2 border-gray-600 overflow-hidden">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="avatar" class="w-full h-full">
                    </div>
                    <div>
                        <h2 class="text-lg font-bold">dava.official</h2>
                        <div class="flex items-center gap-2">
                            <p class="text-[10px] text-gray-400">–£—Ä. 1</p>
                            <div class="w-16 h-1 bg-gray-700 rounded-full"><div class="w-1/4 h-full bg-blue-500 rounded-full"></div></div>
                        </div>
                    </div>
                    <div class="ml-auto flex items-center gap-1">
                        <span class="text-xl font-bold" id="profile-total-bal">0</span>
                        <span class="text-blue-500">üíé</span>
                    </div>
                </div>
                
                <button onclick="openWallet('dep')" class="orbit-btn w-full py-3 mt-5 text-sm">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
            </div>

            <div class="bg-gradient-to-r from-[#007AFF] to-[#00C6FF] rounded-2xl p-4 mb-4 text-center">
                <h3 class="font-bold text-sm mb-1">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π</h3>
                <p class="text-[10px] opacity-90 mb-3">–∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π 10% –æ—Ç –∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤</p>
                <button class="bg-white/20 border border-white/40 text-white text-xs font-bold px-6 py-2 rounded-full w-full">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π</button>
            </div>

            <div class="p-tabs mb-4">
                <div class="p-tab active" onclick="switchTab('gifts', this)">–ü–æ–¥–∞—Ä–∫–∏</div>
                <div class="p-tab" onclick="switchTab('friends', this)">–î—Ä—É–∑—å—è</div>
                <div class="p-tab" onclick="switchTab('history', this)">–ò—Å—Ç–æ—Ä–∏—è</div>
            </div>

            <div id="tab-gifts" class="text-center py-8 border border-[#222] rounded-2xl">
                <div class="text-4xl mb-2 opacity-50">üîç</div>
                <p class="text-xs text-gray-500">–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</p>
            </div>
            
            <div id="tab-friends" class="hidden">
                <div class="flex justify-between bg-[#1C1C1E] p-4 rounded-xl mb-2">
                    <div><p class="text-lg font-bold">0</p><p class="text-[10px] text-gray-500">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</p></div>
                    <div class="text-right"><p class="text-lg font-bold">0üíé</p><p class="text-[10px] text-gray-500">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p></div>
                </div>
            </div>

            <div id="tab-history" class="hidden space-y-2">
                <div class="bg-[#1C1C1E] p-3 rounded-xl flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-green-500/20 text-green-500 flex items-center justify-center text-xs">Win</div>
                        <div><p class="text-xs font-bold">Crash</p><p class="text-[8px] text-gray-500">14:00</p></div>
                    </div>
                    <span class="text-green-500 text-xs font-bold">+50</span>
                </div>
            </div>
        </section>
    </main>

    <nav class="nav-dock">
        <button onclick="nav('crash')" id="nav-crash" class="nav-item active">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.48-.56.93-1.23 1.35-2h4.65c.96 0 1.88.38 2.59 1.06l.32.32a.75.75 0 0 0 1.06 0l2.12-2.12a.75.75 0 0 0 0-1.06l-.32-.32a3.68 3.68 0 0 0-1.06-2.59V8.15c.77-.42 1.44-.87 2-1.35 1.5-1.26 2-5 2-5s-3.74.5-5 2c-.48.56-.93 1.23-1.35 2H9.85c-.96 0-1.88-.38-2.59-1.06l-.32-.32a.75.75 0 0 0-1.06 0L3.76 6.54a.75.75 0 0 0 0 1.06l.32.32c.68.71 1.06 1.63 1.06 2.59v4.65c-.42.77-.87 1.44-1.35 2z"/></svg>
        </button>
        <button onclick="nav('cases')" id="nav-cases" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
        </button>
        <button onclick="nav('profile')" id="nav-profile" class="nav-item">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </button>
    </nav>

    <div id="wallet-modal" class="fixed inset-0 z-[100] bg-black/90 hidden flex flex-col justify-end">
        <div class="bg-[#1C1C1E] rounded-t-[32px] p-6 pb-10 border-t border-gray-800">
            <div class="w-12 h-1.5 bg-gray-700 mx-auto mb-6 rounded-full" onclick="document.getElementById('wallet-modal').classList.add('hidden')"></div>
            <h3 class="text-center font-bold text-white mb-6 uppercase tracking-widest text-lg">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</h3>
            
            <div class="flex gap-2 mb-4">
                <button onclick="switchWalletCurr('stars')" id="wc-stars" class="flex-1 py-3 rounded-xl border border-[#007AFF] bg-[#007AFF]/10 text-[#007AFF] font-bold text-xs">STARS</button>
                <button onclick="switchWalletCurr('ton')" id="wc-ton" class="flex-1 py-3 rounded-xl border border-gray-700 bg-transparent text-gray-500 font-bold text-xs">TON</button>
            </div>

            <div class="bg-black p-4 rounded-xl mb-4 border border-[#333]">
                <input id="wallet-input" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="w-full bg-transparent text-center text-white font-bold text-xl outline-none">
            </div>

            <div class="flex gap-3">
                <button onclick="processWallet()" class="flex-1 py-4 bg-[#007AFF] text-white rounded-xl text-sm font-bold">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                <button onclick="alert('–í—ã–≤–æ–¥ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')" class="flex-1 py-4 bg-[#333] text-white rounded-xl text-sm font-bold">–í—ã–≤–æ–¥</button>
            </div>
        </div>
    </div>

    <script>
        // === STATE ===
        let balances = { stars: 1000, ton: 5.00 };
        let activeCurr = 'stars'; 
        let walletCurr = 'stars';
        let game = { state: 'waiting', mult: 1.0, crashAt: 0, myBet: 0, cashedOut: false };
        let activeCase = null;

        // –ö–µ–π—Å—ã: House Edge (–í—ã–≥–æ–¥–∞ –∫–∞–∑–∏–Ω–æ)
        // 15 –≤—Ö–æ–¥. –ü—Ä–∏–∑—ã: 5, 10, 15, 25, 50. –®–∞–Ω—Å –Ω–∞ <15 –≤—ã—Å–æ–∫–∏–π.
        const casesData = [
            { id: 0, name: "–ù–æ–≤–∏—á–æ–∫", price: 15, curr: 'stars', color: '#39FF14', prizes: [5, 10, 15, 25, 50] },
            { id: 1, name: "–¢—Ä–µ–π–¥–µ—Ä", price: 0.5, curr: 'ton', color: '#0098EA', prizes: [0.1, 0.2, 0.5, 0.8, 1.5] },
            { id: 2, name: "–ú–∞–≥–Ω–∞—Ç", price: 100, curr: 'stars', color: '#FFD700', prizes: [25, 50, 100, 200, 500] }
        ];

        // Icons
        const iconTon = `<svg viewBox="0 0 48 48" fill="none" class="w-full h-full"><circle cx="24" cy="24" r="24" fill="#0098EA"/><path d="M24 11L14 28L24 40L34 28L24 11Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 28L24 18L34 28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M24 40V28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
        const iconStars = `<span class="text-xl">‚≠ê</span>`;

        // === INIT ===
        window.onload = () => {
            setTimeout(() => { document.getElementById('loading-screen').style.opacity=0; setTimeout(()=>document.getElementById('loading-screen').style.display='none',500); }, 2000);
            updateHeader();
        };

        // === UI UPDATES ===
        function updateHeader() {
            const iconContainer = document.getElementById('headerIcon');
            const balanceText = document.getElementById('headerBalance');
            const container = document.getElementById('balance-container');
            
            if(activeCurr === 'stars') {
                iconContainer.innerHTML = iconStars;
                balanceText.innerText = balances.stars.toFixed(0);
                balanceText.style.color = 'white';
                container.style.borderLeftColor = '#39FF14';
            } else {
                iconContainer.innerHTML = iconTon;
                balanceText.innerText = balances.ton.toFixed(2);
                balanceText.style.color = '#0098EA';
                container.style.borderLeftColor = '#0098EA';
            }
            document.getElementById('profile-total-bal').innerText = balances.stars.toFixed(0);
        }

        function setCurrency(c) {
            activeCurr = c;
            // Button Styles
            if(c==='stars') {
                document.getElementById('sw-stars').className="px-4 py-2 rounded-lg text-[10px] font-bold bg-[#333] text-white";
                document.getElementById('sw-ton').className="px-4 py-2 rounded-lg text-[10px] font-bold text-gray-500";
                document.getElementById('min-bet-label').innerText = "Min: 25 Stars";
                document.getElementById('betInput').value = 25;
                document.getElementById('crashBtn').className = 'w-1/2 action-btn neon-btn uppercase text-sm tracking-wider shadow-lg';
            } else {
                document.getElementById('sw-ton').className="px-4 py-2 rounded-lg text-[10px] font-bold bg-[#333] text-white";
                document.getElementById('sw-stars').className="px-4 py-2 rounded-lg text-[10px] font-bold text-gray-500";
                document.getElementById('min-bet-label').innerText = "Min: 0.1 TON";
                document.getElementById('betInput').value = 0.1;
                document.getElementById('crashBtn').className = 'w-1/2 action-btn ton-btn uppercase text-sm tracking-wider shadow-lg';
            }
            updateHeader();
        }

        // === CRASH LOGIC ===
        function handleBetClick() {
            if(game.state === 'waiting' && game.myBet === 0) {
                let val = parseFloat(document.getElementById('betInput').value);
                let min = activeCurr === 'stars' ? 25 : 0.1;
                if(val < min) return alert("–ú–∏–Ω —Å—Ç–∞–≤–∫–∞: " + min);
                if(val > balances[activeCurr]) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
                balances[activeCurr] -= val;
                game.myBet = val;
                runGame();
            } else if(game.state === 'flying' && !game.cashedOut) {
                let win = game.myBet * game.mult;
                balances[activeCurr] += win;
                game.cashedOut = true;
                alert(`–í–´–ò–ì–†–´–®: ${win.toFixed(2)}`);
                updateHeader();
            }
        }

        function runGame() {
            game.state = 'flying'; game.mult = 1.0; game.cashedOut = false;
            document.getElementById('rocket').style.opacity = '1';
            
            // House Edge Algorithm
            let r = Math.random();
            game.crashAt = r < 0.6 ? 1.0 + Math.random()*0.4 : (r < 0.9 ? 1.5 + Math.random() : 2.5 + Math.random()*3);
            
            let loop = setInterval(() => {
                if(game.state !== 'flying') { clearInterval(loop); return; }
                game.mult += 0.01;
                document.getElementById('mult-display').innerText = game.mult.toFixed(2) + 'x';
                
                // Button
                if(!game.cashedOut) {
                    let win = (game.myBet * game.mult).toFixed(2);
                    document.getElementById('crashBtn').innerText = `–ó–ê–ë–†–ê–¢–¨ ${win}`;
                    document.getElementById('crashBtn').classList.replace(activeCurr==='stars'?'neon-btn':'ton-btn', 'bg-white');
                    document.getElementById('crashBtn').style.color = 'black';
                }

                // Rocket Pos
                let p = Math.min(80, (game.mult-1)*30);
                document.getElementById('rocket').style.bottom = (10 + p/2) + '%';
                document.getElementById('rocket').style.left = (10 + p) + '%';

                if(game.mult >= game.crashAt) {
                    game.state = 'crashed';
                    document.getElementById('mult-display').classList.add('text-red-500');
                    document.getElementById('rocket').style.opacity = '0';
                    setTimeout(() => {
                        game.state = 'waiting'; game.myBet = 0;
                        document.getElementById('mult-display').innerText = '1.00x';
                        document.getElementById('mult-display').classList.remove('text-red-500');
                        document.getElementById('crashBtn').innerText = '–°–¢–ê–†–¢';
                        setCurrency(activeCurr); // Reset button style
                    }, 3000);
                    clearInterval(loop);
                }
            }, 30);
        }

        // === CASES LOGIC ===
        function openCaseView(id) {
            activeCase = casesData[id];
            document.getElementById('cases-list').classList.add('hidden');
            document.getElementById('case-roulette-view').classList.remove('hidden');
            document.getElementById('active-case-name').innerText = activeCase.name;
            document.getElementById('spinBtn').innerText = `–ö–†–£–¢–ò–¢–¨ –ó–ê ${activeCase.price} ${activeCase.curr.toUpperCase()}`;
            document.getElementById('spinBtn').style.background = activeCase.color;
            
            const track = document.getElementById('rouletteTrack');
            track.innerHTML = '';
            for(let i=0; i<60; i++) {
                let p = activeCase.prizes[Math.floor(Math.random()*activeCase.prizes.length)];
                let d = document.createElement('div');
                d.className = 'roulette-item';
                d.innerHTML = `<span class="text-xs font-bold text-gray-500">${p}</span>`;
                track.appendChild(d);
            }
            track.style.transition = 'none'; track.style.transform = 'translateX(0)';
        }

        function closeCaseView() {
            document.getElementById('case-roulette-view').classList.add('hidden');
            document.getElementById('cases-list').classList.remove('hidden');
        }

        function spinRoulette() {
            if(balances[activeCase.curr] < activeCase.price) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
            balances[activeCase.curr] -= activeCase.price;
            updateHeader();
            
            const track = document.getElementById('rouletteTrack');
            // House Edge: High chance for low prize
            let r = Math.random();
            let winIdx = r < 0.6 ? 0 : (r < 0.85 ? 1 : 3);
            let winAmount = activeCase.prizes[winIdx];
            
            track.children[45].innerHTML = `<span class="text-xl font-bold text-white">${winAmount}</span>`;
            track.children[45].style.background = activeCase.color;
            
            let offset = (45 * 98) - (track.parentElement.offsetWidth / 2) + 49;
            track.style.transition = 'transform 4s cubic-bezier(0.1,0,0,1)';
            track.style.transform = `translateX(-${offset}px)`;
            
            setTimeout(() => {
                balances[activeCase.curr] += winAmount;
                updateHeader();
                alert(`–í—ã–∏–≥—Ä—ã—à: ${winAmount}`);
            }, 4200);
        }

        // === WALLET & TABS ===
        function openWallet(mode) {
            document.getElementById('wallet-modal').classList.remove('hidden');
        }
        function switchWalletCurr(c) {
            walletCurr = c;
            if(c==='stars') {
                document.getElementById('wc-stars').className="flex-1 py-3 rounded-xl border border-[#007AFF] bg-[#007AFF]/10 text-[#007AFF] font-bold text-xs";
                document.getElementById('wc-ton').className="flex-1 py-3 rounded-xl border border-gray-700 bg-transparent text-gray-500 font-bold text-xs";
            } else {
                document.getElementById('wc-ton').className="flex-1 py-3 rounded-xl border border-[#007AFF] bg-[#007AFF]/10 text-[#007AFF] font-bold text-xs";
                document.getElementById('wc-stars').className="flex-1 py-3 rounded-xl border border-gray-700 bg-transparent text-gray-500 font-bold text-xs";
            }
        }
        function processWallet() {
            let val = parseFloat(document.getElementById('wallet-input').value);
            if(val > 0) {
                balances[walletCurr] += val;
                updateHeader();
                document.getElementById('wallet-modal').classList.add('hidden');
                alert('–£—Å–ø–µ—à–Ω–æ!');
            }
        }
        function switchTab(t, btn) {
            document.querySelectorAll('#tab-gifts, #tab-friends, #tab-history').forEach(e=>e.classList.add('hidden'));
            document.getElementById('tab-'+t).classList.remove('hidden');
            document.querySelectorAll('.p-tab').forEach(e=>e.classList.remove('active'));
            btn.classList.add('active');
        }
        function nav(p) {
            document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
            document.getElementById('page-'+p).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>
