<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OrbitUp Mini App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Orbitron:wght@900&display=swap');
        
        :root { 
            --bg: #000000; 
            --card: #1C1C1E; 
            --blue: #007AFF; 
            --ton: #0098EA;
            --green: #30D158;
            --text-sec: #8E8E93;
        }

        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; margin: 0; user-select: none; }
        
        .font-brand { font-family: 'Orbitron', sans-serif; }
        
        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        #loading-screen {
            position: fixed; inset: 0; background: #000; z-index: 9999;
            display: flex; flex-col; align-items: center; justify-content: center;
            transition: opacity 0.5s ease;
        }
        .loader {
            width: 48px; height: 48px;
            border: 5px solid #FFF; border-bottom-color: var(--blue);
            border-radius: 50%; display: inline-block; box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* –°—Ç–∏–ª–∏ –ø–∞–Ω–µ–ª–µ–π */
        .ios-card { background: var(--card); border-radius: 20px; }
        .ios-btn { border-radius: 12px; font-weight: 600; transition: 0.2s; }
        .ios-btn:active { opacity: 0.7; transform: scale(0.98); }

        /* –í–∫–ª–∞–¥–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è */
        .profile-tabs { background: #2C2C2E; border-radius: 10px; padding: 2px; display: flex; }
        .p-tab { flex: 1; text-align: center; padding: 8px 0; font-size: 13px; font-weight: 600; color: var(--text-sec); border-radius: 8px; transition: 0.2s; }
        .p-tab.active { background: #636366; color: white; }

        /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */
        .nav-dock {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(28, 28, 30, 0.95); backdrop-filter: blur(20px);
            border-top: 0.5px solid #333;
            display: flex; justify-content: space-around; padding: 10px 0 25px 0; z-index: 50;
        }
        .nav-item { color: #666; font-size: 10px; display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .nav-item.active { color: var(--blue); }
        .nav-item svg { width: 24px; height: 24px; }

        /* –í–∫–ª–∞–¥–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .tab-content { display: none; height: calc(100vh - 80px); overflow-y: auto; padding: 20px; padding-bottom: 100px; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –ö—Ä–∞—à –∏ –†—É–ª–µ—Ç–∫–∞ */
        .crash-canvas { background: #111; border-radius: 20px; position: relative; overflow: hidden; height: 250px; border: 1px solid #333; }
        .roulette-wrapper { position: relative; width: 100%; height: 100px; background: #000; border-radius: 16px; overflow: hidden; border: 1px solid #333; }
        .roulette-track { display: flex; position: absolute; height: 100%; align-items: center; left: 0; will-change: transform; }
        .roulette-item { min-width: 80px; height: 80px; margin: 0 4px; background: #1C1C1E; border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1px solid #333; }
        .roulette-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 2px; background: white; z-index: 10; transform: translateX(-50%); }

    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="text-center">
            <h1 class="font-brand text-4xl mb-2 text-white">Orbit<span style="color:var(--blue)">Up</span></h1>
            <p class="text-gray-500 text-sm mb-6">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–ª–µ–Ω–Ω–æ–π...</p>
            <span class="loader"></span>
        </div>
    </div>

    <main>
        <section id="page-crash" class="tab-content active">
            <div class="flex justify-center mb-4">
                <div class="bg-[#2C2C2E] p-1 rounded-xl flex gap-1">
                    <button onclick="setCurrency('stars')" id="sw-stars" class="px-4 py-1.5 rounded-lg text-xs font-bold bg-[#636366] text-white transition">STARS</button>
                    <button onclick="setCurrency('ton')" id="sw-ton" class="px-4 py-1.5 rounded-lg text-xs font-bold text-gray-400 transition">TON</button>
                </div>
            </div>

            <div class="crash-canvas flex flex-col items-center justify-center mb-4 shadow-lg shadow-blue-900/10">
                <div class="absolute inset-0 bg-[radial-gradient(#222_1px,transparent_1px)] [background-size:16px_16px] opacity-30"></div>
                <div id="rocket" class="absolute text-5xl transition-all duration-100 opacity-0" style="bottom: 10%; left: 10%;">üöÄ</div>
                <div id="mult-display" class="relative z-10 text-5xl font-black font-brand">1.00x</div>
                <div id="game-status" class="relative z-10 text-[10px] text-gray-500 font-bold uppercase tracking-widest mt-2">Ready</div>
                <div id="timer-bar" class="absolute bottom-0 left-0 h-1 bg-blue-500 w-0"></div>
            </div>

            <div class="ios-card p-4">
                <div class="flex justify-between text-xs text-gray-500 font-medium mb-2">
                    <span>–°—Ç–∞–≤–∫–∞</span>
                    <span id="min-bet-label">Min: 25 Stars</span>
                </div>
                <div class="flex gap-3">
                    <input id="betInput" type="number" class="w-2/3 bg-black border border-[#333] rounded-xl px-4 text-center text-lg font-bold outline-none focus:border-blue-500 transition" value="25">
                    <button onclick="handleBetClick()" id="crashBtn" class="w-1/3 ios-btn bg-blue-600 text-white py-3">–°–¢–ê–†–¢</button>
                </div>
            </div>
            
            <div class="mt-4 bg-blue-500/10 border border-blue-500/20 rounded-xl p-3 flex items-center gap-3">
                <div class="text-xl">üèÜ</div>
                <div>
                    <p class="text-xs font-bold text-blue-400">–¢—É—Ä–Ω–∏—Ä –ù–µ–¥–µ–ª–∏</p>
                    <p class="text-[10px] text-gray-400">–°–¥–µ–ª–∞–π X100 –∏ –ø–æ–ª—É—á–∏ 50 TON</p>
                </div>
            </div>
        </section>

        <section id="page-cases" class="tab-content">
            <h2 class="text-center font-brand text-2xl mb-6">Mystery Box</h2>
            
            <div id="cases-list" class="space-y-3">
                <div onclick="openCaseView(0)" class="ios-card p-4 flex items-center gap-4 active:scale-95 transition cursor-pointer border border-transparent hover:border-blue-500/30">
                    <div class="w-14 h-14 rounded-xl bg-orange-500/10 flex items-center justify-center text-2xl">üß∏</div>
                    <div class="flex-grow">
                        <h3 class="font-bold text-sm">–ù–æ–≤–∏—á–æ–∫</h3>
                        <p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 15 Stars</p>
                    </div>
                    <button class="bg-orange-500 text-white text-[10px] font-bold px-3 py-1.5 rounded-full">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
                <div onclick="openCaseView(1)" class="ios-card p-4 flex items-center gap-4 active:scale-95 transition cursor-pointer border border-transparent hover:border-blue-500/30">
                    <div class="w-14 h-14 rounded-xl bg-blue-500/10 flex items-center justify-center text-2xl">üíº</div>
                    <div class="flex-grow">
                        <h3 class="font-bold text-sm">–¢—Ä–µ–π–¥–µ—Ä</h3>
                        <p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 0.5 TON</p>
                    </div>
                    <button class="bg-blue-500 text-white text-[10px] font-bold px-3 py-1.5 rounded-full">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
                <div onclick="openCaseView(2)" class="ios-card p-4 flex items-center gap-4 active:scale-95 transition cursor-pointer border border-transparent hover:border-blue-500/30">
                    <div class="w-14 h-14 rounded-xl bg-purple-500/10 flex items-center justify-center text-2xl">üëë</div>
                    <div class="flex-grow">
                        <h3 class="font-bold text-sm">–ú–∞–≥–Ω–∞—Ç</h3>
                        <p class="text-[10px] text-gray-500">–¶–µ–Ω–∞: 100 Stars</p>
                    </div>
                    <button class="bg-purple-500 text-white text-[10px] font-bold px-3 py-1.5 rounded-full">–û—Ç–∫—Ä—ã—Ç—å</button>
                </div>
            </div>

            <div id="case-roulette-view" class="hidden flex flex-col h-full">
                <button onclick="closeCaseView()" class="self-start text-xs font-bold text-gray-500 mb-6 flex items-center gap-1">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 18l-6-6 6-6"/></svg>
                    –ù–∞–∑–∞–¥
                </button>
                
                <div class="flex-grow flex flex-col justify-center pb-20">
                    <h2 id="active-case-name" class="text-center text-2xl font-black font-brand mb-2">CASE</h2>
                    <p class="text-center text-xs text-gray-500 mb-8">–ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É</p>
                    
                    <div class="roulette-wrapper mb-6">
                        <div class="roulette-marker"></div>
                        <div id="rouletteTrack" class="roulette-track"></div>
                    </div>

                    <button onclick="spinRoulette()" id="spinBtn" class="w-full py-4 rounded-xl font-bold uppercase text-sm shadow-lg transition bg-blue-600">
                        –ö—Ä—É—Ç–∏—Ç—å
                    </button>
                </div>
            </div>
        </section>

        <section id="page-profile" class="tab-content">
            <div class="ios-card p-5 mb-4 relative overflow-hidden">
                <div class="flex items-center gap-4 relative z-10">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-tr from-blue-600 to-purple-600 p-[2px]">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Orbit" class="w-full h-full rounded-full bg-black" alt="avatar">
                    </div>
                    <div>
                        <h2 class="text-lg font-bold">User #8841</h2>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-0.5 rounded">–£—Ä–æ–≤–µ–Ω—å 1</span>
                            <span class="text-[10px] text-gray-500">ID: 559231</span>
                        </div>
                    </div>
                    <div class="ml-auto text-gray-500">‚öôÔ∏è</div>
                </div>
                <div class="mt-6">
                     <p class="text-xs text-gray-400 text-center mb-2">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                     <div class="flex justify-center gap-4 items-end mb-4">
                         <div class="text-center">
                             <span class="text-2xl font-bold text-white block" id="p-stars">0</span>
                             <span class="text-[10px] text-yellow-500 font-bold">STARS</span>
                         </div>
                         <div class="w-px h-8 bg-gray-700"></div>
                         <div class="text-center">
                             <span class="text-2xl font-bold text-white block" id="p-ton">0.00</span>
                             <span class="text-[10px] text-blue-400 font-bold">TON</span>
                         </div>
                     </div>
                     
                     <div class="flex gap-3">
                         <button onclick="openWallet('dep')" class="flex-1 bg-blue-600 text-white py-3 rounded-xl text-xs font-bold">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                         <button onclick="openWallet('with')" class="flex-1 bg-[#2C2C2E] text-white py-3 rounded-xl text-xs font-bold">–í—ã–≤–µ—Å—Ç–∏</button>
                     </div>
                </div>
            </div>

            <div class="bg-gradient-to-r from-blue-600 to-blue-400 rounded-xl p-4 mb-4 text-center">
                <h3 class="font-bold text-sm mb-1">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π</h3>
                <p class="text-[10px] opacity-90 mb-3">–∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π 10% –æ—Ç –∏—Ö –¥–µ–ø–æ–∑–∏—Ç–æ–≤</p>
                <button class="bg-white text-blue-600 text-xs font-bold px-6 py-2 rounded-full w-full">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥—Ä—É–∑–µ–π</button>
            </div>

            <div class="profile-tabs mb-4">
                <div class="p-tab active" onclick="switchProfileTab('gifts', this)">–ü–æ–¥–∞—Ä–∫–∏</div>
                <div class="p-tab" onclick="switchProfileTab('friends', this)">–î—Ä—É–∑—å—è</div>
                <div class="p-tab" onclick="switchProfileTab('history', this)">–ò—Å—Ç–æ—Ä–∏—è</div>
            </div>

            <div id="ptab-gifts" class="block text-center py-10">
                <div class="text-4xl mb-2">üîç</div>
                <p class="text-gray-500 text-xs">–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –ø–æ–¥–∞—Ä–∫–æ–≤</p>
            </div>

            <div id="ptab-friends" class="hidden">
                <div class="flex justify-between mb-4 px-2">
                    <div class="text-center"><p class="text-xl font-bold">3</p><p class="text-[10px] text-gray-500">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</p></div>
                    <div class="text-center"><p class="text-xl font-bold">0üíé</p><p class="text-[10px] text-gray-500">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ</p></div>
                </div>
                <p class="text-xs text-gray-400 mb-2 px-2">–ú–æ–∏ –¥—Ä—É–∑—å—è:</p>
                <div class="ios-card p-3 flex items-center gap-3 mb-2">
                    <div class="w-8 h-8 rounded-full bg-gray-700"></div>
                    <div><p class="text-xs font-bold">AlexCrypto</p><p class="text-[9px] text-gray-500">–í—á–µ—Ä–∞</p></div>
                    <div class="ml-auto text-xs font-bold text-blue-400">+50‚≠ê</div>
                </div>
                 <div class="ios-card p-3 flex items-center gap-3">
                    <div class="w-8 h-8 rounded-full bg-gray-700"></div>
                    <div><p class="text-xs font-bold">Maria_Ton</p><p class="text-[9px] text-gray-500">–°–µ–≥–æ–¥–Ω—è</p></div>
                    <div class="ml-auto text-xs font-bold text-blue-400">+100‚≠ê</div>
                </div>
            </div>

            <div id="ptab-history" class="hidden space-y-2">
                <div class="flex items-center justify-between p-2 border-b border-gray-800">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-green-500/20 text-green-500 flex items-center justify-center text-xs">Win</div>
                        <div><p class="text-xs font-bold">Crash Game</p><p class="text-[9px] text-gray-500">14:20</p></div>
                    </div>
                    <div class="text-green-500 text-xs font-bold">+25 Stars</div>
                </div>
                <div class="flex items-center justify-between p-2 border-b border-gray-800">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded bg-red-500/20 text-red-500 flex items-center justify-center text-xs">Lose</div>
                        <div><p class="text-xs font-bold">Novice Case</p><p class="text-[9px] text-gray-500">14:15</p></div>
                    </div>
                    <div class="text-white text-xs font-bold">-15 Stars</div>
                </div>
            </div>
        </section>
    </main>

    <nav class="nav-dock">
        <div class="nav-item" onclick="nav('rating')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><rect x="4" y="14" width="16" height="6" rx="2"/></svg>
            <span>–õ–∏–¥–µ—Ä—ã</span>
        </div>
        <div class="nav-item" onclick="nav('cases')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 12V8H6a2 2 0 0 1-2-2c0-1.1.9-2 2-2h12v4"/><path d="M4 6v12c0 1.1.9 2 2 2h14v-4"/><path d="M18 12a2 2 0 0 0-2 2c0 1.1.9 2 2 2h4v-4h-4z"/></svg>
            <span>–†–æ–∑—ã–≥—Ä—ã—à–∏</span>
        </div>
        <div class="nav-item active" onclick="nav('crash')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.48-.56.93-1.23 1.35-2h4.65c.96 0 1.88.38 2.59 1.06l.32.32a.75.75 0 0 0 1.06 0l2.12-2.12a.75.75 0 0 0 0-1.06l-.32-.32a3.68 3.68 0 0 0-1.06-2.59V8.15c.77-.42 1.44-.87 2-1.35 1.5-1.26 2-5 2-5s-3.74.5-5 2c-.48.56-.93 1.23-1.35 2H9.85c-.96 0-1.88-.38-2.59-1.06l-.32-.32a.75.75 0 0 0-1.06 0L3.76 6.54a.75.75 0 0 0 0 1.06l.32.32c.68.71 1.06 1.63 1.06 2.59v4.65c-.42.77-.87 1.44-1.35 2z"/></svg>
            <span>–ò–≥—Ä–∞—Ç—å</span>
        </div>
        <div class="nav-item" onclick="nav('tasks')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
            <span>–ó–∞–¥–∞–Ω–∏—è</span>
        </div>
        <div class="nav-item" onclick="nav('profile')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </div>
    </nav>

    <div id="wallet-modal" class="hidden fixed inset-0 bg-black/80 z-[100] flex items-end">
        <div class="bg-[#1C1C1E] w-full rounded-t-[24px] p-6 pb-10">
            <div class="w-10 h-1 bg-gray-600 mx-auto rounded-full mb-6" onclick="closeWallet()"></div>
            <h3 class="text-center font-bold text-lg mb-6" id="wallet-title">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
            
            <div class="flex gap-2 mb-4">
                <button onclick="selectWalletCurr('stars')" id="wc-stars" class="flex-1 py-3 bg-[#2C2C2E] rounded-xl border border-blue-500 text-blue-500 font-bold text-xs">STARS</button>
                <button onclick="selectWalletCurr('ton')" id="wc-ton" class="flex-1 py-3 bg-[#2C2C2E] rounded-xl border border-transparent text-gray-400 font-bold text-xs">TON</button>
            </div>

            <input id="wallet-input" type="number" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É" class="w-full bg-[#000] p-4 rounded-xl text-center text-white font-bold outline-none mb-4 border border-[#333]">
            
            <button onclick="processWallet()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // === STATE ===
        let balances = { stars: 1000, ton: 5.0 };
        let currentCurr = 'stars';
        let walletMode = 'dep'; // dep or with
        let walletCurr = 'stars';
        
        // –ö–µ–π—Å—ã: –î–æ–±–∞–≤–∏–ª 5 –∏ 10 –∑–≤–µ–∑–¥, —á—Ç–æ–±—ã –±—ã–ª–∞ –≤—ã–≥–æ–¥–∞ –∫–∞–∑–∏–Ω–æ (–∏–≥—Ä–æ–∫ —Ç—Ä–∞—Ç–∏—Ç 15)
        const cases = [
            { id: 0, name: "–ù–æ–≤–∏—á–æ–∫", price: 15, curr: 'stars', prizes: [5, 10, 15, 25, 50] },
            { id: 1, name: "–¢—Ä–µ–π–¥–µ—Ä", price: 0.5, curr: 'ton', prizes: [0.1, 0.2, 0.5, 0.8, 1.5] },
            { id: 2, name: "–ú–∞–≥–Ω–∞—Ç", price: 100, curr: 'stars', prizes: [25, 50, 100, 200, 500] }
        ];
        let activeCase = null;

        // Crash State
        let game = { state: 'idle', mult: 1.0, crashAt: 0, bet: 0, cashed: false };

        // === INIT ===
        window.onload = () => {
            // Loading Screen Animation
            setTimeout(() => {
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(() => document.getElementById('loading-screen').style.display = 'none', 500);
            }, 2000);
            updateUI();
        };

        // === NAVIGATION ===
        function nav(page) {
            if(page === 'rating' || page === 'tasks') return alert('–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...');
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('page-' + page).classList.add('active');
            
            // Highlight icon
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function switchProfileTab(tab, btn) {
            document.querySelectorAll('#ptab-gifts, #ptab-friends, #ptab-history').forEach(el => el.classList.add('hidden'));
            document.getElementById('ptab-'+tab).classList.remove('hidden');
            
            document.querySelectorAll('.p-tab').forEach(el => {
                el.classList.remove('active');
                el.style.background = 'transparent';
                el.style.color = '#8E8E93';
            });
            btn.classList.add('active');
        }

        // === CRASH LOGIC ===
        function setCurrency(c) {
            currentCurr = c;
            // Toggle Buttons
            if(c === 'stars') {
                document.getElementById('sw-stars').classList.replace('text-gray-400','text-white');
                document.getElementById('sw-stars').classList.replace('bg-transparent','bg-[#636366]');
                document.getElementById('sw-ton').classList.replace('text-white','text-gray-400');
                document.getElementById('sw-ton').classList.replace('bg-[#636366]','bg-transparent');
                
                document.getElementById('min-bet-label').innerText = "Min: 25 Stars";
                document.getElementById('betInput').value = 25;
            } else {
                document.getElementById('sw-ton').classList.replace('text-gray-400','text-white');
                document.getElementById('sw-ton').classList.replace('bg-transparent','bg-[#636366]');
                document.getElementById('sw-stars').classList.replace('text-white','text-gray-400');
                document.getElementById('sw-stars').classList.replace('bg-[#636366]','bg-transparent');
                
                document.getElementById('min-bet-label').innerText = "Min: 0.1 TON";
                document.getElementById('betInput').value = 0.1;
            }
        }

        function handleBetClick() {
            if(game.state === 'idle') {
                let val = parseFloat(document.getElementById('betInput').value);
                let min = currentCurr==='stars'?25:0.1;
                
                if(val < min) return alert('–ú–∏–Ω —Å—Ç–∞–≤–∫–∞: ' + min);
                if(val > balances[currentCurr]) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
                
                balances[currentCurr] -= val;
                game.bet = val;
                startGame();
            } else if(game.state === 'flying' && !game.cashed) {
                let win = game.bet * game.mult;
                balances[currentCurr] += win;
                game.cashed = true;
                alert(`–í—ã–∏–≥—Ä—ã—à: ${win.toFixed(2)}`);
                updateUI();
                document.getElementById('crashBtn').innerText = "–í–´–ò–ì–†–´–®";
                document.getElementById('crashBtn').disabled = true;
            }
        }

        function startGame() {
            game.state = 'flying'; game.mult = 1.0; game.cashed = false;
            
            document.getElementById('rocket').style.opacity = '1';
            document.getElementById('timer-bar').style.width = '100%';
            document.getElementById('timer-bar').style.transition = 'width 10s linear';
            
            // House Edge: 60% chance to crash low (<1.4)
            let r = Math.random();
            game.crashAt = r < 0.6 ? 1.0 + Math.random()*0.4 : (r < 0.9 ? 1.5 + Math.random() : 2.5 + Math.random()*3);
            
            let loop = setInterval(() => {
                if(game.state !== 'flying') { clearInterval(loop); return; }
                
                game.mult += 0.01;
                document.getElementById('mult-display').innerText = game.mult.toFixed(2) + 'x';
                
                // Button Text
                if(!game.cashed) {
                    let win = (game.bet * game.mult).toFixed(2);
                    let btn = document.getElementById('crashBtn');
                    btn.innerText = `–ó–ê–ë–†–ê–¢–¨ ${win}`;
                    btn.classList.replace('bg-blue-600', 'bg-green-500');
                }

                // Move Rocket
                let p = Math.min(80, (game.mult - 1) * 30);
                document.getElementById('rocket').style.bottom = (10 + p/2) + '%';
                document.getElementById('rocket').style.left = (10 + p) + '%';

                if(game.mult >= game.crashAt) {
                    game.state = 'crashed';
                    document.getElementById('mult-display').classList.add('text-red-500');
                    document.getElementById('rocket').style.opacity = '0';
                    document.getElementById('crashBtn').innerText = "CRASHED";
                    document.getElementById('crashBtn').classList.replace('bg-green-500', 'bg-red-500');
                    
                    setTimeout(() => {
                        game.state = 'idle'; game.bet = 0;
                        document.getElementById('mult-display').innerText = "1.00x";
                        document.getElementById('mult-display').classList.remove('text-red-500');
                        document.getElementById('crashBtn').innerText = "–°–¢–ê–†–¢";
                        document.getElementById('crashBtn').classList.replace('bg-red-500', 'bg-blue-600');
                        document.getElementById('crashBtn').disabled = false;
                        document.getElementById('timer-bar').style.width = '0%';
                        document.getElementById('timer-bar').style.transition = 'none';
                    }, 3000);
                    clearInterval(loop);
                }
            }, 30);
            updateUI();
        }

        // === CASES LOGIC ===
        function openCaseView(id) {
            activeCase = cases[id];
            document.getElementById('cases-list').classList.add('hidden');
            document.getElementById('case-roulette-view').classList.remove('hidden');
            
            document.getElementById('active-case-name').innerText = activeCase.name;
            document.getElementById('spinBtn').innerText = `–ö—Ä—É—Ç–∏—Ç—å –∑–∞ ${activeCase.price} ${activeCase.curr.toUpperCase()}`;
            
            // Build Roulette
            const track = document.getElementById('rouletteTrack');
            track.innerHTML = '';
            for(let i=0; i<50; i++) {
                // Random visual fill
                let p = activeCase.prizes[Math.floor(Math.random()*activeCase.prizes.length)];
                let div = document.createElement('div');
                div.className = 'roulette-item';
                div.innerHTML = `<span class="text-xs text-gray-500 font-bold">${p}</span>`;
                track.appendChild(div);
            }
            track.style.transition = 'none';
            track.style.transform = 'translateX(0)';
        }

        function closeCaseView() {
            document.getElementById('case-roulette-view').classList.add('hidden');
            document.getElementById('cases-list').classList.remove('hidden');
        }

        function spinRoulette() {
            if(balances[activeCase.curr] < activeCase.price) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
            balances[activeCase.curr] -= activeCase.price;
            updateUI();
            
            let btn = document.getElementById('spinBtn');
            btn.disabled = true;

            // Logic: High chance for Low Prize (Break even or Loss)
            let r = Math.random();
            let prizeIndex = r < 0.5 ? 0 : (r < 0.8 ? 1 : (r < 0.95 ? 2 : 4)); // 0=min prize (loss), 1=mid
            let winAmount = activeCase.prizes[prizeIndex];

            // Set visual target
            const track = document.getElementById('rouletteTrack');
            let targetCardIdx = 35;
            let card = track.children[targetCardIdx];
            card.innerHTML = `<span class="text-xl font-bold text-white">${winAmount}</span>`;
            card.style.background = '#007AFF';

            let offset = (targetCardIdx * 88) - (track.parentElement.offsetWidth / 2) + 40;
            track.style.transition = 'transform 4s cubic-bezier(0.1, 0, 0, 1)';
            track.style.transform = `translateX(-${offset}px)`;

            setTimeout(() => {
                balances[activeCase.curr] += winAmount;
                alert(`–í—ã–ø–∞–ª–æ: ${winAmount}`);
                updateUI();
                btn.disabled = false;
                closeCaseView(); // Reset
            }, 4200);
        }

        // === WALLET ===
        function openWallet(mode) {
            walletMode = mode;
            document.getElementById('wallet-modal').classList.remove('hidden');
            document.getElementById('wallet-title').innerText = mode === 'dep' ? '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ' : '–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤';
            selectWalletCurr('stars'); // reset to stars
        }

        function closeWallet() {
            document.getElementById('wallet-modal').classList.add('hidden');
        }

        function selectWalletCurr(c) {
            walletCurr = c;
            if(c === 'stars') {
                document.getElementById('wc-stars').classList.add('border-blue-500', 'text-blue-500');
                document.getElementById('wc-stars').classList.remove('border-transparent', 'text-gray-400');
                document.getElementById('wc-ton').classList.remove('border-blue-500', 'text-blue-500');
                document.getElementById('wc-ton').classList.add('border-transparent', 'text-gray-400');
            } else {
                document.getElementById('wc-ton').classList.add('border-blue-500', 'text-blue-500');
                document.getElementById('wc-ton').classList.remove('border-transparent', 'text-gray-400');
                document.getElementById('wc-stars').classList.remove('border-blue-500', 'text-blue-500');
                document.getElementById('wc-stars').classList.add('border-transparent', 'text-gray-400');
            }
        }

        function processWallet() {
            let val = parseFloat(document.getElementById('wallet-input').value);
            if(!val || val <= 0) return alert('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É');
            
            if(walletMode === 'dep') {
                balances[walletCurr] += val;
                alert('–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω!');
            } else {
                if(balances[walletCurr] < val) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                balances[walletCurr] -= val;
                alert('–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞!');
            }
            updateUI();
            closeWallet();
        }

        function updateUI() {
            document.getElementById('p-stars').innerText = balances.stars.toFixed(0);
            document.getElementById('p-ton').innerText = balances.ton.toFixed(2);
        }

    </script>
</body>
</html>
