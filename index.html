<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Lime Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@400;600;800&display=swap');
        
        :root { 
            --lime: #ccff00; /* Premium Lime */
            --green-glow: rgba(204, 255, 0, 0.4);
            --ton: #0098EA; 
            --bg: #050505; 
        }

        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
            height: 100vh; 
            margin: 0; 
            user-select: none; 
            background-image: radial-gradient(circle at 50% 0%, #1a2e05 0%, #000000 60%);
        }
        
        .font-tech { font-family: 'Orbitron', sans-serif; }
        
        /* –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ (Premium Dark) */
        .glass-panel { 
            background: rgba(10, 10, 10, 0.85); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.8);
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .lime-btn { 
            background: var(--lime); 
            color: black; 
            box-shadow: 0 0 20px var(--green-glow); 
            transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .lime-btn:active { transform: scale(0.96); box-shadow: 0 0 10px var(--green-glow); }
        
        .ton-btn { 
            background: var(--ton); 
            color: white; 
            box-shadow: 0 0 20px rgba(0, 152, 234, 0.4); 
            transition: 0.2s;
        }
        .ton-btn:active { transform: scale(0.96); }

        .action-btn { font-weight: 800; border-radius: 16px; letter-spacing: 1px; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è Dock */
        .nav-dock {
            position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px;
            background: rgba(5, 5, 5, 0.9); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05); border-radius: 30px;
            display: flex; justify-content: space-around; padding: 14px 0; z-index: 50;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
        }
        .nav-item { color: #444; padding: 8px; border-radius: 12px; transition: 0.3s; }
        .nav-item.active { color: var(--lime); transform: translateY(-5px); }
        .nav-item.active svg { filter: drop-shadow(0 0 8px var(--lime)); }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tab-content { display: none; height: calc(100vh - 100px); overflow-y: auto; padding: 20px; padding-bottom: 120px; }
        .tab-content.active { display: block; animation: fadeUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ –ö—Ä–∞—à–µ */
        .crash-switch { background: #0a0a0a; border-radius: 14px; padding: 4px; display: inline-flex; border: 1px solid #222; margin-bottom: 20px; }
        .switch-opt { padding: 8px 20px; border-radius: 10px; font-size: 11px; font-weight: 800; color: #555; transition: 0.3s; text-transform: uppercase; }
        .switch-opt.active-s { background: rgba(204, 255, 0, 0.1); color: var(--lime); border: 1px solid var(--lime); box-shadow: 0 0 15px rgba(204, 255, 0, 0.1); }
        .switch-opt.active-t { background: rgba(0, 152, 234, 0.1); color: var(--ton); border: 1px solid var(--ton); box-shadow: 0 0 15px rgba(0, 152, 234, 0.1); }

        /* –†—É–ª–µ—Ç–∫–∞ –ö–µ–π—Å–æ–≤ */
        .roulette-wrapper { position: relative; width: 100%; height: 120px; background: #000; border-radius: 20px; overflow: hidden; border: 1px solid #222; margin-bottom: 24px; box-shadow: inset 0 0 30px rgba(0,0,0,0.8); }
        .roulette-track { display: flex; position: absolute; height: 100%; align-items: center; left: 0; will-change: transform; }
        .roulette-item { min-width: 100px; height: 100px; margin: 0 5px; background: #0a0a0a; border-radius: 16px; border: 1px solid #222; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .roulette-marker { position: absolute; left: 50%; top: 0; bottom: 0; width: 3px; background: var(--lime); z-index: 10; transform: translateX(-50%); box-shadow: 0 0 15px var(--lime); }
    </style>
</head>
<body>

    <header class="pt-4 px-6 flex justify-between items-center z-20 relative">
        <div onclick="openWallet()" class="glass-panel rounded-2xl py-2 px-4 flex items-center gap-3 cursor-pointer active:scale-95 transition border-l-2 border-[#ccff00]" id="balance-container">
            <div id="headerIcon" class="w-6 h-6 flex items-center justify-center"></div>
            <div class="flex flex-col leading-none">
                <span class="text-[9px] text-gray-500 font-bold uppercase tracking-widest mb-1">–ë–∞–ª–∞–Ω—Å</span>
                <span class="font-tech font-bold text-lg text-white tracking-wide" id="headerBalance">0</span>
            </div>
        </div>

        <div class="text-right">
            <p class="text-[9px] text-[#ccff00] uppercase font-bold mb-1 tracking-widest">LEVEL 1</p>
            <div class="w-20 h-1.5 bg-gray-900 rounded-full overflow-hidden border border-gray-800">
                <div class="h-full bg-[#ccff00] w-1/3 shadow-[0_0_10px_#ccff00]"></div>
            </div>
        </div>
    </header>

    <main>
        <section id="page-crash" class="tab-content active">
            
            <div class="flex justify-center">
                <div class="crash-switch">
                    <button onclick="setCurrency('stars')" id="sw-stars" class="switch-opt active-s">STARS</button>
                    <button onclick="setCurrency('ton')" id="sw-ton" class="switch-opt">TON</button>
                </div>
            </div>

            <div class="relative w-full h-80 bg-black rounded-[32px] border border-[#222] mb-6 overflow-hidden flex flex-col items-center justify-center shadow-2xl shadow-black/80">
                <div class="absolute inset-0" style="background-image: linear-gradient(rgba(204, 255, 0, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(204, 255, 0, 0.05) 1px, transparent 1px); background-size: 40px 40px;"></div>
                <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                
                <div id="rocket" class="absolute text-6xl transition-all duration-100 ease-linear drop-shadow-[0_0_15px_rgba(204,255,0,0.5)]" style="bottom: 15%; left: 10%; opacity: 0;">üöÄ</div>
                
                <div id="mult-display" class="relative z-10 text-6xl font-black font-tech text-white transition-transform">1.00x</div>
                <div id="game-status" class="relative z-10 text-[10px] text-gray-600 font-bold uppercase tracking-[0.3em] mt-3">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞</div>
                
                <div id="timer-bar" class="absolute bottom-0 left-0 h-1 bg-[#ccff00] w-0 shadow-[0_0_20px_#ccff00]"></div>
            </div>

            <div class="glass-panel rounded-[28px] p-6">
                <div class="flex justify-between text-[10px] text-gray-500 font-bold uppercase mb-3 tracking-wider">
                    <span>–°—É–º–º–∞ —Å—Ç–∞–≤–∫–∏</span>
                    <span id="min-bet-label" class="text-[#ccff00]">Min: 25</span>
                </div>
                <div class="flex gap-4">
                    <div class="relative flex-grow">
                        <input id="betInput" type="number" class="w-full bg-[#050505] border border-[#222] rounded-2xl p-4 text-center text-xl font-bold text-white outline-none focus:border-[#ccff00] transition placeholder-gray-800">
                    </div>
                    <button onclick="handleBetClick()" id="crashBtn" class="w-1/2 action-btn lime-btn uppercase text-sm tracking-widest shadow-lg">–°–¢–ê–†–¢</button>
                </div>
            </div>
        </section>

        <section id="page-cases" class="tab-content">
            <h2 class="text-center font-tech text-xl font-black uppercase text-white mb-8 tracking-widest">Mystery <span style="color:var(--lime)">Box</span></h2>
            
            <div id="cases-list" class="grid gap-4">
                <div onclick="openCaseView(0)" class="glass-panel p-5 rounded-[28px] flex items-center gap-5 border border-gray-800 active:scale-95 transition cursor-pointer hover:border-[#ccff00] group">
                    <div class="w-16 h-16 rounded-2xl bg-[#ccff00]/10 flex items-center justify-center text-3xl group-hover:scale-110 transition">üì¶</div>
                    <div class="flex-grow">
                        <h3 class="font-bold text-lg text-white">–ù–æ–≤–∏—á–æ–∫</h3>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">–î–æ 100 Stars</p>
                    </div>
                    <div class="text-right">
                        <p class="font-tech font-bold text-[#ccff00] text-lg">50 ‚≠ê</p>
                        <span class="text-[9px] font-bold text-gray-600 uppercase">–û—Ç–∫—Ä—ã—Ç—å</span>
                    </div>
                </div>

                <div onclick="openCaseView(1)" class="glass-panel p-5 rounded-[28px] flex items-center gap-5 border border-gray-800 active:scale-95 transition cursor-pointer hover:border-[#0098EA] group">
                    <div class="w-16 h-16 rounded-2xl bg-[#0098EA]/10 flex items-center justify-center text-3xl group-hover:scale-110 transition">üíé</div>
                    <div class="flex-grow">
                        <h3 class="font-bold text-lg text-white">–¢—Ä–µ–π–¥–µ—Ä</h3>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">–ü—Ä–∏–∑—ã –≤ TON</p>
                    </div>
                    <div class="text-right">
                        <p class="font-tech font-bold text-[#0098EA] text-lg">0.5 T</p>
                        <span class="text-[9px] font-bold text-gray-600 uppercase">–û—Ç–∫—Ä—ã—Ç—å</span>
                    </div>
                </div>
                
                <div onclick="openCaseView(2)" class="glass-panel p-5 rounded-[28px] flex items-center gap-5 border border-gray-800 active:scale-95 transition cursor-pointer hover:border-yellow-500 group">
                    <div class="w-16 h-16 rounded-2xl bg-yellow-500/10 flex items-center justify-center text-3xl group-hover:scale-110 transition">üëë</div>
                    <div class="flex-grow">
                        <h3 class="font-bold text-lg text-yellow-500">–ú–∞–≥–Ω–∞—Ç</h3>
                        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">–î–∂–µ–∫–ø–æ—Ç</p>
                    </div>
                    <div class="text-right">
                        <p class="font-tech font-bold text-yellow-500 text-lg">500 ‚≠ê</p>
                        <span class="text-[9px] font-bold text-gray-600 uppercase">–û—Ç–∫—Ä—ã—Ç—å</span>
                    </div>
                </div>
            </div>

            <div id="case-roulette-view" class="hidden h-full flex flex-col">
                <button onclick="closeCaseView()" class="mb-8 text-[10px] font-bold text-gray-500 flex items-center gap-2 hover:text-white uppercase tracking-widest transition">
                    <span class="text-lg">‚Üê</span> –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </button>
                
                <div class="flex-grow flex flex-col justify-center pb-24">
                    <h2 id="active-case-name" class="text-center text-4xl font-black font-tech mb-10 uppercase tracking-widest text-white drop-shadow-[0_0_15px_rgba(255,255,255,0.2)]">Case</h2>
                    
                    <div class="roulette-wrapper">
                        <div class="roulette-marker"></div>
                        <div id="rouletteTrack" class="roulette-track"></div>
                    </div>

                    <div class="text-center mt-8 px-4">
                        <button onclick="spinRoulette()" id="spinBtn" class="w-full py-5 rounded-2xl font-black uppercase text-sm tracking-[0.2em] shadow-2xl transition transform active:scale-95 text-black bg-[#ccff00]">
                            –ö–†–£–¢–ò–¢–¨
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="page-profile" class="tab-content">
            <div class="glass-panel p-8 rounded-[32px] text-center mt-6 border-t border-[#ccff00]/20">
                <div class="w-28 h-28 mx-auto bg-black rounded-full flex items-center justify-center text-5xl mb-6 border-2 border-[#ccff00] shadow-[0_0_30px_rgba(204,255,0,0.2)]">üòé</div>
                <h2 class="text-2xl font-bold uppercase tracking-widest text-white">Player One</h2>
                <div class="mt-3 inline-block bg-[#ccff00]/10 border border-[#ccff00]/20 px-4 py-1 rounded-full">
                    <p class="text-[10px] text-[#ccff00] font-bold uppercase tracking-widest">ID: 994211</p>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mt-10">
                    <div class="bg-black/60 p-5 rounded-3xl border border-[#222]">
                        <p class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mb-2">Stars Balance</p>
                        <p class="font-tech text-[#ccff00] text-2xl" id="p-stars">0</p>
                    </div>
                    <div class="bg-black/60 p-5 rounded-3xl border border-[#222]">
                        <p class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mb-2">TON Balance</p>
                        <p class="font-tech text-[#0098EA] text-2xl" id="p-ton">0</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <nav class="nav-dock">
        <div onclick="nav('crash')" id="nav-crash" class="nav-item active flex flex-col items-center">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.48-.56.93-1.23 1.35-2h4.65c.96 0 1.88.38 2.59 1.06l.32.32a.75.75 0 0 0 1.06 0l2.12-2.12a.75.75 0 0 0 0-1.06l-.32-.32a3.68 3.68 0 0 0-1.06-2.59V8.15c.77-.42 1.44-.87 2-1.35 1.5-1.26 2-5 2-5s-3.74.5-5 2c-.48.56-.93 1.23-1.35 2H9.85c-.96 0-1.88-.38-2.59-1.06l-.32-.32a.75.75 0 0 0-1.06 0L3.76 6.54a.75.75 0 0 0 0 1.06l.32.32c.68.71 1.06 1.63 1.06 2.59v4.65c-.42.77-.87 1.44-1.35 2z"/></svg>
        </div>
        <div onclick="nav('cases')" id="nav-cases" class="nav-item flex flex-col items-center">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
        </div>
        <div onclick="nav('profile')" id="nav-profile" class="nav-item flex flex-col items-center">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
        </div>
    </nav>

    <div id="wallet-modal" class="fixed inset-0 z-[100] bg-black/90 backdrop-blur-sm hidden flex flex-col justify-end">
        <div class="bg-[#0f0f0f] rounded-t-[40px] p-8 border-t border-[#333]">
            <div class="w-12 h-1 bg-gray-800 mx-auto mb-8 rounded-full cursor-pointer" onclick="document.getElementById('wallet-modal').classList.add('hidden')"></div>
            <h3 class="text-center font-bold text-white mb-8 uppercase tracking-widest text-xl">–ö–æ—à–µ–ª–µ–∫</h3>
            
            <div class="bg-black border border-[#222] rounded-3xl p-6 mb-6 text-center">
                 <p class="text-gray-500 text-[10px] uppercase font-bold tracking-widest mb-2">–¢–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                 <p class="text-3xl font-black font-tech text-white" id="wallet-balance-disp">0</p>
            </div>

            <div class="flex gap-4">
                <button onclick="addBalance(100)" class="w-full py-5 bg-[#ccff00] text-black rounded-2xl text-sm font-black uppercase hover:opacity-90 shadow-[0_0_20px_rgba(204,255,0,0.3)] tracking-widest">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // === –î–ê–ù–ù–´–ï ===
        let balances = { stars: 1000, ton: 5.00 };
        let activeCurr = 'stars'; 
        let game = { state: 'waiting', mult: 1.0, crashAt: 0, myBet: 0, cashedOut: false };
        let activeCase = null;

        const casesData = [
            { id: 0, name: "–ù–æ–≤–∏—á–æ–∫", price: 50, curr: 'stars', color: '#ccff00', prizes: [10, 25, 50, 75, 100, 150] },
            { id: 1, name: "–¢—Ä–µ–π–¥–µ—Ä", price: 0.5, curr: 'ton', color: '#0098EA', prizes: [0.1, 0.3, 0.5, 0.8, 1.0, 2.0] },
            { id: 2, name: "–ú–∞–≥–Ω–∞—Ç", price: 500, curr: 'stars', color: '#FFD700', prizes: [100, 250, 500, 1000, 2500, 5000] }
        ];

        // –ò–∫–æ–Ω–∫–∏
        const iconTon = `<svg viewBox="0 0 48 48" fill="none" class="w-full h-full"><circle cx="24" cy="24" r="24" fill="#0098EA"/><path d="M24 11L14 28L24 40L34 28L24 11Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 28L24 18L34 28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/><path d="M24 40V28" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>`;
        const iconStars = `<span class="text-xl">‚≠ê</span>`;

        function updateHeader() {
            const iconContainer = document.getElementById('headerIcon');
            const balanceText = document.getElementById('headerBalance');
            const container = document.getElementById('balance-container');
            const walletDisp = document.getElementById('wallet-balance-disp');
            
            if(activeCurr === 'stars') {
                iconContainer.innerHTML = iconStars;
                balanceText.innerText = balances.stars.toFixed(0);
                balanceText.style.color = '#ccff00';
                container.style.borderLeftColor = '#ccff00';
                walletDisp.innerText = balances.stars.toFixed(0) + " Stars";
                walletDisp.style.color = '#ccff00';
            } else {
                iconContainer.innerHTML = iconTon;
                balanceText.innerText = balances.ton.toFixed(2);
                balanceText.style.color = '#0098EA';
                container.style.borderLeftColor = '#0098EA';
                walletDisp.innerText = balances.ton.toFixed(2) + " TON";
                walletDisp.style.color = '#0098EA';
            }
            document.getElementById('p-stars').innerText = balances.stars.toFixed(0);
            document.getElementById('p-ton').innerText = balances.ton.toFixed(2);
        }

        function setCurrency(c) {
            activeCurr = c;
            document.getElementById('sw-stars').className = c==='stars' ? 'switch-opt active-s' : 'switch-opt';
            document.getElementById('sw-ton').className = c==='ton' ? 'switch-opt active-t' : 'switch-opt';
            
            const btn = document.getElementById('crashBtn');
            const minLabel = document.getElementById('min-bet-label');
            const timerBar = document.getElementById('timer-bar');

            if(c === 'stars') {
                minLabel.innerText = "Min: 25 Stars";
                minLabel.style.color = "#ccff00";
                document.getElementById('betInput').value = 25;
                btn.className = 'w-1/2 action-btn lime-btn uppercase text-sm tracking-widest shadow-lg';
                timerBar.style.backgroundColor = '#ccff00';
                timerBar.style.boxShadow = '0 0 20px #ccff00';
            } else {
                minLabel.innerText = "Min: 0.1 TON";
                minLabel.style.color = "#0098EA";
                document.getElementById('betInput').value = 0.1;
                btn.className = 'w-1/2 action-btn ton-btn uppercase text-sm tracking-widest shadow-lg';
                timerBar.style.backgroundColor = '#0098EA';
                timerBar.style.boxShadow = '0 0 20px #0098EA';
            }
            updateHeader();
        }

        // === CRASH GAME LOGIC ===
        function runGame() {
            game.state = 'waiting'; game.cashedOut = false; game.mult = 1.0;
            
            document.getElementById('mult-display').innerText = "1.00x";
            document.getElementById('mult-display').className = "relative z-10 text-6xl font-black font-tech text-white transition-transform";
            document.getElementById('game-status').innerText = "–ü–û–î–ì–û–¢–û–í–ö–ê";
            document.getElementById('rocket').style.opacity = '0';
            
            const bar = document.getElementById('timer-bar');
            bar.style.width = '100%'; bar.style.transition = 'width 5s linear';
            
            updateBtn();

            setTimeout(() => {
                bar.style.transition = 'none'; bar.style.width = '0%';
                launch();
            }, 5000);
        }

        function launch() {
            game.state = 'flying';
            document.getElementById('game-status').innerText = "–ü–û–õ–ï–¢";
            document.getElementById('rocket').style.opacity = '1';

            // === –ê–õ–ì–û–†–ò–¢–ú "–ë–†–ò–¢–í–ê" ===
            let r = Math.random();
            if (r < 0.15) game.crashAt = 1.00 + Math.random() * 0.05;
            else if (r < 0.55) game.crashAt = 1.06 + Math.random() * 0.44;
            else if (r < 0.85) game.crashAt = 1.50 + Math.random() * 1.0;
            else game.crashAt = 2.50 + Math.random() * 5.0;
            
            updateBtn();

            let loop = setInterval(() => {
                if(game.state !== 'flying') { clearInterval(loop); return; }

                game.mult += 0.01;
                document.getElementById('mult-display').innerText = game.mult.toFixed(2) + 'x';
                
                let p = Math.min(80, (game.mult - 1) * 25);
                document.getElementById('rocket').style.bottom = (15 + p/2) + '%';
                document.getElementById('rocket').style.left = (10 + p) + '%';

                if(game.mult >= game.crashAt) {
                    crash();
                }
            }, 40);
        }

        function crash() {
            game.state = 'crashed';
            document.getElementById('mult-display').innerText = "CRASH";
            document.getElementById('mult-display').className = "relative z-10 text-6xl font-black font-tech text-red-600 scale-110";
            document.getElementById('rocket').style.opacity = '0';
            document.getElementById('game-status').innerText = "–í–ó–†–´–í";
            
            game.myBet = 0;
            updateBtn();
            setTimeout(runGame, 3000);
        }

        function handleBetClick() {
            if(game.state === 'waiting' && game.myBet === 0) {
                let val = parseFloat(document.getElementById('betInput').value);
                let min = activeCurr === 'stars' ? 25 : 0.1;
                
                if(val < min) return alert("–ú–∏–Ω —Å—Ç–∞–≤–∫–∞: " + min);
                if(val > balances[activeCurr]) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");

                balances[activeCurr] -= val;
                game.myBet = val;
                updateHeader();
                updateBtn();
            } 
            else if(game.state === 'flying' && game.myBet > 0 && !game.cashedOut) {
                let win = game.myBet * game.mult;
                balances[activeCurr] += win;
                game.cashedOut = true;
                
                document.getElementById('mult-display').className = "relative z-10 text-6xl font-black font-tech text-[#ccff00] scale-110";
                
                game.myBet = 0; 
                updateHeader();
                updateBtn();
            }
        }

        function updateBtn() {
            const btn = document.getElementById('crashBtn');
            
            if(game.state === 'waiting') {
                if(game.myBet > 0) {
                    btn.innerText = "–ñ–î–ï–ú...";
                    btn.className = "w-1/2 action-btn bg-[#1a1a1a] text-gray-500 text-xs";
                    btn.disabled = true;
                } else {
                    btn.innerText = "–°–¢–ê–†–¢";
                    btn.className = activeCurr === 'stars' 
                        ? 'w-1/2 action-btn lime-btn uppercase text-sm tracking-widest shadow-lg' 
                        : 'w-1/2 action-btn ton-btn uppercase text-sm tracking-widest shadow-lg';
                    btn.disabled = false;
                }
            } 
            else if(game.state === 'flying') {
                if(game.myBet > 0 && !game.cashedOut) {
                    let currentWin = (game.myBet * game.mult).toFixed(2);
                    btn.innerText = "–ó–ê–ë–†–ê–¢–¨ " + currentWin;
                    btn.className = "w-1/2 action-btn bg-white text-black text-sm font-black shadow-[0_0_20px_white]";
                    btn.disabled = false;
                } else if (game.cashedOut) {
                    btn.innerText = "–í–´–ò–ì–†–´–®!";
                    btn.className = "w-1/2 action-btn bg-[#ccff00] text-black text-xs font-bold";
                    btn.disabled = true;
                } else {
                    btn.innerText = "–í –ü–û–õ–ï–¢–ï...";
                    btn.className = "w-1/2 action-btn bg-[#1a1a1a] text-gray-500 text-xs";
                    btn.disabled = true;
                }
            } 
            else {
                btn.innerText = "CRASH";
                btn.className = "w-1/2 action-btn bg-red-900 text-white text-xs";
                btn.disabled = true;
            }
        }

        // === CASES LOGIC ===
        function openCaseView(id) {
            activeCase = casesData[id];
            document.getElementById('cases-list').classList.add('hidden');
            document.getElementById('case-roulette-view').classList.remove('hidden');
            
            document.getElementById('active-case-name').innerText = activeCase.name;
            document.getElementById('active-case-name').style.color = activeCase.color;
            
            const btn = document.getElementById('spinBtn');
            btn.innerText = `–ö–†–£–¢–ò–¢–¨ –ó–ê ${activeCase.price} ${activeCase.curr.toUpperCase()}`;
            btn.style.backgroundColor = activeCase.color;
            btn.disabled = false;
            
            initRoulette();
        }

        function closeCaseView() {
            document.getElementById('case-roulette-view').classList.add('hidden');
            document.getElementById('cases-list').classList.remove('hidden');
        }

        function initRoulette() {
            const track = document.getElementById('rouletteTrack');
            track.innerHTML = '';
            for(let i=0; i<60; i++) {
                let prize = activeCase.prizes[Math.floor(Math.random() * activeCase.prizes.length)];
                let div = document.createElement('div');
                div.className = 'roulette-item';
                div.innerHTML = `<span class="text-2xl">${activeCase.curr==='ton'?'üíé':'‚≠ê'}</span><span class="text-xs font-bold mt-2 text-gray-400">${prize}</span>`;
                track.appendChild(div);
            }
            track.style.transition = 'none';
            track.style.transform = 'translateX(0)';
        }

        function spinRoulette() {
            if (balances[activeCase.curr] < activeCase.price) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!');
            
            balances[activeCase.curr] -= activeCase.price;
            updateHeader();
            
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            
            const track = document.getElementById('rouletteTrack');
            
            let r = Math.random();
            let winIdx = r < 0.6 ? 0 : (r < 0.85 ? 1 : (r < 0.95 ? 2 : 4));
            if(winIdx >= activeCase.prizes.length) winIdx = 0;
            
            let winAmount = activeCase.prizes[winIdx];
            let targetIdx = 45; 
            
            track.children[targetIdx].innerHTML = `<span class="text-3xl animate-bounce">${activeCase.curr==='ton'?'üíé':'‚≠ê'}</span><span class="text-sm font-black mt-2 text-white">${winAmount}</span>`;
            track.children[targetIdx].style.borderColor = activeCase.color;
            track.children[targetIdx].style.boxShadow = `0 0 20px ${activeCase.color}`;
            track.children[targetIdx].style.background = '#1a1a1a';

            let cardWidth = 110; 
            let offset = (targetIdx * cardWidth) - (track.parentElement.offsetWidth / 2) + (cardWidth / 2);
            
            track.style.transition = 'transform 4s cubic-bezier(0.15, 0, 0, 1)';
            track.style.transform = `translateX(-${offset}px)`;

            setTimeout(() => {
                balances[activeCase.curr] += winAmount;
                updateHeader();
                alert(`–í—ã–∏–≥—Ä—ã—à: ${winAmount} ${activeCase.curr.toUpperCase()}`);
                btn.disabled = false;
            }, 4100);
        }

        // === UTILS ===
        function openWallet() { document.getElementById('wallet-modal').classList.remove('hidden'); }
        function addBalance(amt) { balances[activeCurr]+=amt; updateHeader(); }
        function nav(p) { 
            document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
            document.getElementById('page-'+p).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
            document.getElementById('nav-'+p).classList.add('active');
        }

        window.onload = () => {
            setCurrency('stars');
            runGame();
        };
    </script>
</body>
</html>
